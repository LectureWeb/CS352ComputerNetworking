<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title> CS 417 Documents </title>
<link href="../../../css/layout.css" rel="stylesheet" type="text/css" />
<link href="../../../css/main.css" rel="stylesheet" type="text/css" />
<link href="../../../css/print.css" rel="stylesheet" type="text/css" media="print" />
<link href="../../../css/main-print.css" rel="stylesheet" type="text/css" media="print" />
<style type="text/css">

#main table.doclist {
	width: 80%;
}
#main .doclist .date, #main .doclist .item {
        vertical-align: baseline; /* for opera */
}
#main .doclist tr {
        vertical-align: baseline;
}
#main .doclist th.item {
        text-align: left;
}
#main .doclist td.item {
        text-align: left;
}
#main a.linksign:link, #main a.linksign:visited, #main a.linksign a:hover {
        text-decoration: none;
}

</style>
</head>
<body id="s_ru416">
<div id="wrapper">
<!-- _______________________________________ BANNER _______________________________________ -->
<div id="banner">
  <div id="logo">
  <img src="../../../css/images/pk-org-pencil.png" alt="pk.org" name="logo" width="122" height="45"/>
  </div>
  <div id="title"> Distributed Systems </div>
  <div id="search">
  <form method="get" action="http://www.google.com/search">
	<div style="border:none ;padding:2px;width:25em;">
	<input type="text" name="q" size="25" maxlength="255" value="" />
	<input type="submit" value="Search" />
	<input type="hidden"  name="sitesearch" value="www.pk.org" checked />
	</div>
  </form>
  </div>
  <ul>
    <li class="separator"><a href="../../../about/index.html">About</a></li>
    <li class="separator"><a href="../../../about/contact.html">Contact</a></li>
    <li><a href="../../../sitemap.html">Site map</a></li>
  </ul>
</div>

<!-- _______________________________________ MAIN NAV _______________________________________ -->
<div id="navbar">
	<ul>
	<li class="homelink"><a href="../../../index.html">Home</a></li>
<!--
	<li class="aboutlink"><a href="../../../about/index.html">About</a></li>
-->
	<li class="ru"><a href="../../../rutgers/index.html">Rutgers</a></li>
	<li class="ru352"><a href="../../../352/index.html">Internet Technology [352]</a></li>
	<li class="ru416"><a href="../../../416/index.html">Operating Systems [416]</a></li>
	<li class="ru417"><a href="../../../417/index.html">Distributed Systems [417]</a></li>
	<li class="ru419"><a href="../../../419/index.html">Computer Security [419]</a></li>
	<li class="cslink"><a href="../../../cs/index.html">Computing</a></li>
	<li class="photolink"><a href="../../../photo/index.html">Photography</a></li>
<!--
	<li class="funlink"><a href="#">Coming</a></li>
	<li class="funlink"><a href="#">Soon</a></li>
-->
	</ul>
</div>

<div id="subnav">
<p>
You are in: 
<ul>
	<li class="first"> <a href="index.html"> Home </a> 
 	<li> <a href="../../../rutgers/index.html"> Rutgers </a> 
 	<li> <a href="../../index.html"> CS 416 </a> 
 	<li> <a href="../../notes/index.html"> Documents </a> 
 	<li> <a href="../../notes/make/index.html"> Clocks Demo </a> 
</ul>
</p>
</div>
<div id="content-wrapper">
<div id="main">
<div id="headline">
<h1> Assigning Lamport & Vector Timestamps </h1>
</div>

<h1> Introduction </h1>
<p>
This is a brief example of assigning Lamport Timestamps and Vector Timestamps.
The details of the algorithms are described in the 
<a href="../content/06-clocks.pdf">Clock Synchronization</a> notes.
This page is less formal and supplements the lecture notes.
</p>

<h1> Lamport Clocks </h1>
<p>
Each process maintains a single Lamport timestamp counter. Each event on the process is tagged with
a timestamp from this counter.  The counter is incremented before the event timestamp is assigned.
If a process has four events, <i>a, b, c, d</i>, they would get Lamport timestamps of <i>1, 2, 3, 4</i>.
</p>
<p>
If an event is the sending of a message then the timestamp is sent along with the message.
If an event is the receipt of a message then the the algorithm instructs you to compare the current
value of the process' timestamp counter (which was just incremented before this event) with the timestamp
in the received message. If the timestamp of the received message is greater than that of the current system,
the system timestamp is updated with that of the timestamp in the received message plus one. This ensures that 
the timestamp of the received event and all further timestamps will be greater than that of the 
timestamp of sending the message as well as all previous messages.
</p>
<p>
In the figure below, event <i>k</i> in process P<sub>1</sub> is the receipt of the message
sent by event <i>g</i> in P<sub>0</sub>. If event <i>k</i> was just a normal local event, the
P<sub>1</sub> would assign it a timestamp of 4. However, since the received timestamp is 6, which
is greater than 4, the timestamp counter is set to 6+1, or 7. Event <i>k</i> gets the timestamp of 7.
A local event after <i>k</i> would get a timestamp of 8.
</p>

<p>
With Lamport timestamps, we're assured that two causally-related events will
have timestamps that reflect the order of events. For example, 
event <i>c</i> happened before event <i>k</i> in the Lamport causal sense: the
chain of causal events is
<i>c</i>&rarr;<i>d</i>,
<i>d</i>&rarr;<i>f</i>,
<i>f</i>&rarr;<i>g</i>, and
<i>g</i>&rarr;<i>k</i>.
Since the <i>happened-before</i> relationship is transitive, we know that
<i>c</i>&rarr;<i>k</i> (<i>c</i> happened before <i>k</i>).
The Lamport timestamps reflect this. The timestamp
for <i>c</i> (3) is less than the timestamp for <i>k</i> (7). However, just 
by looking at timestamps we cannot conclude that there is a causal happened-before
relation.
For instance, because the timestamp for <i>l</i> (1) is less than
the timestamp for <i>j</i> (3) does not mean that <i>l</i> happened before
<i>j</i>. Those events happen to be concurrent but we cannot discern that
by looking at Lamport timestamps.
We need need to employ a different technique to be able to make that determination. That technique is the use of <em>vector timestamps</em>.
</p>

<div class="figure-center width450">
<img src="images/clocks-lamport.png" width=408 height=244 alt="lamport clocks" title="Lamport Clock Assignment"/>
<p>
Lamport Clock Assignments
</p>
</div>

<br/>

<h1> Vector Clocks </h1>
<p>
With vector clocks, we assume that we know the number of processes in the group. Our timestamp is now 
a vector of numbers, with each element corresponding to a process. Each process knows its position
in the vector. For example, in the example below, the vector corresponds to the processes
(P<sub>0</sub>, P<sub>1</sub>, P<sub>2</sub>).
</p>
<p>
As with Lamport's algorithm, the element corresponding to the processor in the vector timestamp
is incremented prior to attaching a timestamp to an event.
If a process P<sub>0</sub> has four events, <i>a, b, c, d</i>, they would get
Vector timestamps of <i>(1,0,0), (2, 0, 0), (3, 0, 0), (4, 0, 0)</i>.
If a process P<sub>2</sub> has four events, <i>a, b, c, d</i>, they would get
Vector timestamps of <i>(0,0,1), (0, 0, 2), (0, 0, 3), (0, 0, 4)</i>.
</p>

<p>
The entire vector is sent along with a message. When the message is received by a process
(that is an event that will get a timestamp), the reciving process does the following:
<ol>
<li> increment the counter for the process' position in the vector, just as it would
prior to timstamping any local event.</li>
<li>
<p>
Peform an element-by-element comparison of the received vector with the process' timestamp
vector. Set the process' timestamp vector to the higher of the values:
</p>
<div class="codeblock">
for (i=0; i &lt; num_elements; i++) 
	if (received[i] > system[i])
		system[i] = received[i];
</div>
</li>
</ol>
</p>
<p>
To determine if two events are concurrent, do an element-by-element comparison of the corresponding
timestamps.
If each element of timestamp V is less than or equal to the corresponding element of
timestamp W then V causally precedes W and the events are not concurrent. 
If each element of timestamp V is greater than or equal to the corresponding element of
timestamp W then W causally precedes V and the events are not concurrent. 
If, on the other hand, neither of those conditions apply and some elements in V are greater
than while others are less than the corresponding element in W then the events are concurrent.
We can summarize it with the pseudocode:
</p>
<div class="codeblock">
isconcurrent(int v[], int w[])
{
	bool greater=false, less=false;

	for (i=0; i &lt; num_elements; i++) 
		if (v[i] &gt; w[i])
			greater = true;
		else (v[i] &lt; w[i])
			less = true;
	if (greater && less)
		return true;	/* the vectors are concurrent */
	else
		return false;	/* the vectors are not concurrent */
}
</div>
</p>
<p>
In the figure below, the timestamp for <i>m</i> is less than the
timestamp for <i>g</i> because each element in <i>m</i> is less than or equal
to the corresponding element in <i>g</i>. That is, 
0 &le; 6, 0 &le; 1, and 2 &le; 2.
</p>

<p>
The timestamps for <i>c</i> and <i>j</i>, on the other hand, are
concurrent.
If we compare the first element, we see that
<i>c</i> &ge; <i>j</i> (3 &ge; 2).
If we compare the second element, we see that
<i>c</i> &le; <i>j</i> (1 &le; 2). Because of this, 
we cannot say that the vector for <i>c</i> is either less than
or greater than the vector for <i>j</i>.
</p>

<div class="figure-center width450">
<img src="images/clocks-vector.png" width=419 height=244 alt="vector clocks" title="Vector Clock Assignment"/>
<p>
Vector Clock Assignments
</p>
</div>
</div>
<div id="footer">
<hr/>
<style type="text/css">  
span.codedirection { unicode-bidi:bidi-override; direction: rtl; }  
</style>  

<p> &copy; 2003-2019 Paul Krzyzanowski. All rights reserved.</p>
<p>For questions or comments about this site, contact Paul Krzyzanowski, 
<span class="codedirection">gro.kp@ofnibew</span>
</p>
<p>
The entire contents of this site are protected by copyright under national and international law.
No part of this site may be copied, reproduced, stored in a retrieval system, or transmitted, in any form,
or by any means whether electronic, mechanical or otherwise without the prior written
consent of the copyright holder.
If there is something on this page that you want to use, please let me know.
</p>
<p>
Any opinions expressed on this page do not necessarily reflect the opinions of my employers and may not
even reflect my own.
</p>
<p> Last updated: February 14, 2019
</p>
<img class="stamp" src="../../..//css/images/recycled_pixels_logo.png" alt="recycled pixels" height="80" width="80" />
</div> <!-- footer -->
<div id="tear">
</div>


<div id="sidebar1">
<h1 class="first">Contents </h1>
	<h2> CS 416 </h2>
	<ul>
	<li> <a href="../../index.html"> Main course page </a> </li>
	<li> <a href="../../news.html"> News </a> </li>
	<li> <a href="../../syllabus.html"> Syllabus </a> </li>
	<li> <a href="../../hw/index.html"> Homework </a> </li>
	<li> <a href="../../notes/index.html"> Documents </a> </li>
	<li> <a href="../../exam/index.html"> Exam info </a> </li>
	<li> <a href="../../grades/index.html"> Check your grades </a> </li>
	<li> <a href="https://sakai.rutgers.edu/portal"> Sakai </a> </li>
	</ul>

        <h2> Tutorials </h2>
        <ul>
        <li> <a href="../../notes/c-tutorials/index.html"> C/Unix tutorials </a> </li>
        <li> <a href="../../notes/make/index.html"> Makefile tutorial </a> </li>
        <li> <a href="../../notes/sockets/index.html"> TCP/IP Sockets </a> </li>
        <li> <a href="../../notes/rpc/index.html"> ONC RPC tutorial </a> </li>
<!--
        <li> <a href="../../notes/clocks/index.html"> Clocks demo </a> </li>
-->
        </ul>

	
</div>

<div id="sidebar2">
<!--
<h1 class="first"> Free junk </h1>
<p>
Tedst
</p>
<hr/>
<ul>
<li> List item
</ul>
-->
</div>

</div>
</div>
</body>
</html>
