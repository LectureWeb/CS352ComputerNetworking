<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title> CS 416 Documents </title>
<link href="../../../css/layout.css" rel="stylesheet" type="text/css" />
<link href="../../../css/main.css" rel="stylesheet" type="text/css" />
<link href="../../../css/print.css" rel="stylesheet" type="text/css" media="print" />
<link href="../../../css/main-print.css" rel="stylesheet" type="text/css" media="print" />
<style type="text/css">

#main table.doclist {
	width: 80%;
}
#main .doclist .date, #main .doclist .item {
        vertical-align: baseline; /* for opera */
}
#main .doclist tr {
        vertical-align: baseline;
}
#main .doclist th.item {
        text-align: left;
}
#main .doclist td.item {
        text-align: left;
}
#main a.linksign:link, #main a.linksign:visited, #main a.linksign a:hover {
        text-decoration: none;
}

</style>
</head>
<body id="s_ru416">
<div id="wrapper">
<!-- _______________________________________ BANNER _______________________________________ -->
<div id="banner">
  <div id="logo">
  <img src="../../../css/images/pk-org-pencil.png" alt="pk.org" name="logo" width="122" height="45"/>
  </div>
  <div id="title"> Operating Systems </div>
  <div id="search">
  <form method="get" action="http://www.google.com/search">
	<div style="border:none ;padding:2px;width:25em;">
	<input type="text" name="q" size="25" maxlength="255" value="" />
	<input type="submit" value="Search" />
	<input type="hidden"  name="sitesearch" value="www.pk.org" checked />
	</div>
  </form>
  </div>
  <ul>
    <li class="separator"><a href="../../../about/index.html">About</a></li>
    <li class="separator"><a href="../../../about/contact.html">Contact</a></li>
    <li><a href="../../../sitemap.html">Site map</a></li>
  </ul>
</div>

<!-- _______________________________________ MAIN NAV _______________________________________ -->
<div id="navbar">
	<ul>
	<li class="homelink"><a href="../../../index.html">Home</a></li>
<!--
	<li class="aboutlink"><a href="../../../about/index.html">About</a></li>
-->
	<li class="ru"><a href="../../../rutgers/index.html">Rutgers</a></li>
	<li class="ru352"><a href="../../../352/index.html">Internet Technology [352]</a></li>
	<li class="ru416"><a href="../../../416/index.html">Operating Systems [416]</a></li>
	<li class="ru417"><a href="../../../417/index.html">Distributed Systems [417]</a></li>
	<li class="ru419"><a href="../../../419/index.html">Computer Security [419]</a></li>
	<li class="cslink"><a href="../../../cs/index.html">Computing</a></li>
	<li class="photolink"><a href="../../../photo/index.html">Photography</a></li>
<!--
	<li class="funlink"><a href="#">Coming</a></li>
	<li class="funlink"><a href="#">Soon</a></li>
-->
	</ul>
</div>

<div id="subnav">
<p>
You are in: 
</p>
<ul>
	<li class="first"> <a href="index.html"> Home </a> 
 	<li> <a href="../../../rutgers/index.html"> Rutgers </a> 
 	<li> <a href="../../index.html"> CS 416 </a> 
 	<li> <a href="../../notes/index.html"> Documents </a> 
 	<li> <a href="../../notes/c-tutorials/index.html"> Tutorials </a> 
 	<li> <a href="../../notes/c-tutorials/exec.html"> Exec Tutorial </a> 
</ul>
</div>
<div id="content-wrapper">
<div id="main">
<div id="headline">
<h1> C Tutorial: Playing with processes </h1>
</div>

<h1> Running a new process: exec </h1>
<p>
The <em>fork</em> system call creates a new process but that process
contains, and is executing, exactly the same code that the parent process has.
More often than not, we'd like to run a new program.
The <em>execve</em> system call replaces the current process with a new program.
The syntox of <em>execve</em> is:
</p>
<div class="codeblock">
int
execve(const char *path, char *const argv[], char *const envp[]);
</div>
<p>
This system call returns only if the named program could not run.
</p>
<p>
<tt>argv</tt> is the argument list that is passed to the <em>main</em> function of the program, which is the function
that is called when any program starts.
The last item on the list is 0 (to mark the end of the list). The first, <tt>argv[0]</tt>,
is essentially ignored and expected to contain the command name.
The program that is executed may use it to find out its name.
</p>
<p>
<tt>filename</tt> contains the fill pathname of the program to load and run; for example, <tt>"/bin/ls"</tt>.
This is what the operating system tries to load.
</p>
<p>
<tt>envp</tt> contains character strings representing the environment in the form <em>name=value</em>.
<tt>envp</tt> is also stored in the global variable <tt>char&nbsp;**environ</tt>
(<em>getenv</em> is a library function to search the environment for the value of a particular name).
</p>
<h2> Example  </h2>
<p>
This is a small program that overrites itself with another program. The program first
prints a message stating that it will run the <em>ls</em> program and then execute:
</p>
<div class="codeblock">
ls -aF /
</div>
<p>
As soon as <em>execve</em> is called, the process is overritten with the new program
(<em>/bin/ls</em>) and the program's <em>main</em> function gets run.
</p>

<div class="codeblock-box"><span class="comment">/* execve: run a program */</span>
<span class="comment">/* Paul Krzyzanowski */</span>

#include &lt;stdlib.h&gt;	<span class="comment">/* needed to define exit() */</span>
#include &lt;unistd.h&gt;	<span class="comment">/* needed to define getpid() */</span>
#include &lt;stdio.h&gt;	<span class="comment">/* needed for printf() */</span>

int
main(int argc, char **argv) {
	char *args[] = {"ls", "-aF", "/", 0};	<span class="comment">/* each element represents a command line argument */</span>
	char *env[] = { 0 };	<span class="comment">/* leave the environment list null */</span>

	printf("About to run /bin/ls\n");
	execve("/bin/ls", args, env);
	perror("execve");	<span class="comment">/* if we get here, execve failed */</span>
	exit(1);
}

</div>

<p>
<a href="files/execve.c">Download this file</a>
</p>
<p>
Save this file by control-clicking or right clicking the download link and then saving it as <tt>execve.c</tt>.
</p>
<p>
Compile this program via:
</p>
<div class="codeblock">
gcc -o execve execve.c
</div>
<p>
If you don't have gcc, You may need to substitute the gcc command with cc or another name of your compiler.
</p>
<p>
Run the program:
</p>
<div class="codeblock">
./execve
</div>
</p>
<p>
Try replacing the <tt>"/bin/ls"</tt> string in the first argument to <em>execve</em> with a nonexistent file
and see what happens.
</p>

<h3> Variations on exec </h3>
<p>
In addition to the <em>execve</em> syatem call, there are a number
of library routines that are front-ends to execve. 
You will usually fine these more convenient than <em>execve</em>. They are described
in the <em>execl</em> manual page. There are six of these functions. A couple
of useful ones are <em>execlp</em> and <em>execvp</em>.
</p>
<h3> execlp </h3>
<p>
<em>execlp</em>, which allows you to specify all the arguments as parameters to the function.
Note that the 
first parameter is the command. The second parameter is the first argument in the
argument list that is passed to the program (<tt>argv[0]</tt>). These are often the same
but don't have to be. The last parameter must be a null pointer.A <em>execlp</em>
uses the search path set by the PATH environment variable to find the command. For example,
</p>
<div class="codeblock">
execlp("ls", "ls", "-aF", "/", (char *)0);
</div>
</p>
<div class="codeblock-box"><span class="comment">/* execlp: run a program using execlp */</span>
<span class="comment">/* Paul Krzyzanowski */</span>

#include &lt;stdlib.h&gt;	<span class="comment">/* needed to define exit() */</span>
#include &lt;unistd.h&gt;	<span class="comment">/* needed to define getpid() */</span>
#include &lt;stdio.h&gt;	<span class="comment">/* needed for printf() */</span>

int
main(int argc, char **argv) {

	printf("About to run ls\n");
	execlp("ls", "ls", "-aF", "/", (char*)0);
	perror("execlp");	<span class="comment">/* if we get here, execlp failed */</span>
	exit(1);
}

</div>
<p>
<a href="files/execlp.c">Download this file</a>
</p>
<p>
Save this file by control-clicking or right clicking the download link and then saving it as <tt>execlp.c</tt>.
</p>
<p>
Compile this program via:
</p>
<div class="codeblock">
gcc -o execlp execlp.c
</div>
<p>
Run the program:
</p>
<div class="codeblock">
./execlp
</div>

<h3> execvp </h3>
<p>
The function <em>execvp</em> is almost like the system call <em>execve</em> except that the PATH environment
variable is used as a search path for the command and the default
environment is used, so you don't have to worry about passing the environment or searching for the command. Hereâ€™s an example:
</p>
<div class="codeblock">
char **av[] = { "ls", "-al", "/usr/paul", (char *)0};
execvp("ls", av);
</div>
</p>
<div class="codeblock-box"><span class="comment">/* execvp: run a program using execvp */</span>
<span class="comment">/* Paul Krzyzanowski */</span>

#include &lt;stdlib.h&gt;	<span class="comment">/* needed to define exit() */</span>
#include &lt;unistd.h&gt;	<span class="comment">/* needed to define getpid() */</span>
#include &lt;stdio.h&gt;	<span class="comment">/* needed for printf() */</span>

int
main(int argc, char **argv) {
	char *args[] = {"ls", "-aF", "/", 0};	<span class="comment">/* each element represents a command line argument */</span>

	printf("About to run ls\n");
	execvp("ls", args);
	perror("execvp");	<span class="comment">/* if we get here, execvp failed */</span>
	exit(1);
}

</div>
<p>
<a href="files/execvp.c">Download this file</a>
</p>
<p>
Save this file by control-clicking or right clicking the download link and then saving it as <tt>execvp.c</tt>.
</p>
<p>
Compile this program via:
</p>
<div class="codeblock">
gcc -o execvp execvp.c
</div>
<p>
Run the program:
</p>
<div class="codeblock">
./execvp
</div>

</div>
<div id="footer">
<hr/>
<style type="text/css">  
span.codedirection { unicode-bidi:bidi-override; direction: rtl; }  
</style>  

<p> &copy; 2003-2019 Paul Krzyzanowski. All rights reserved.</p>
<p>For questions or comments about this site, contact Paul Krzyzanowski, 
<span class="codedirection">gro.kp@ofnibew</span>
</p>
<p>
The entire contents of this site are protected by copyright under national and international law.
No part of this site may be copied, reproduced, stored in a retrieval system, or transmitted, in any form,
or by any means whether electronic, mechanical or otherwise without the prior written
consent of the copyright holder.
If there is something on this page that you want to use, please let me know.
</p>
<p>
Any opinions expressed on this page do not necessarily reflect the opinions of my employers and may not
even reflect my own.
</p>
<p> Last updated: March 28, 2019
</p>
<img class="stamp" src="../../..//css/images/recycled_pixels_logo.png" alt="recycled pixels" height="80" width="80" />
</div> <!-- footer -->
<div id="tear">
</div>


<div id="sidebar1">
<h1 class="first">Contents </h1>
	<h2> CS 416 </h2>
	<ul>
	<li> <a href="../../index.html"> Main course page </a> </li>
	<li> <a href="../../news.html"> News </a> </li>
	<li> <a href="../../syllabus.html"> Syllabus </a> </li>
	<li> <a href="../../hw/index.html"> Homework </a> </li>
	<li> <a href="../../notes/index.html"> Documents </a> </li>
	<li> <a href="../../exam/index.html"> Exam info </a> </li>
	<li> <a href="../../grades/index.html"> Check your grades </a> </li>
	<li> <a href="https://sakai.rutgers.edu/portal"> Sakai </a> </li>
	</ul>

        <h2> Tutorials </h2>
        <ul>
        <li> <a href="../../notes/c-tutorials/index.html"> C/Unix tutorials </a> </li>
        <li> <a href="../../notes/make/index.html"> Makefile tutorial </a> </li>
        <li> <a href="../../notes/sockets/index.html"> TCP/IP Sockets </a> </li>
        <li> <a href="../../notes/rpc/index.html"> ONC RPC tutorial </a> </li>
<!--
        <li> <a href="../../notes/clocks/index.html"> Clocks demo </a> </li>
-->
        </ul>

	
        <h2> <a href="index.html">C Tutorials</a> </h2>
	<h3> Processes </h3>
        <ul>
        <li> <a href="../../notes/c-tutorials/getpid.html"> getpid </a> </li>
        <li> <a href="../../notes/c-tutorials/getppid.html"> getppid </a> </li>
        <li> <a href="../../notes/c-tutorials/fork.html"> fork </a> </li>
        <li> <a href="../../notes/c-tutorials/exec.html"> exec </a> </li>
        <li> <a href="../../notes/c-tutorials/forkexec.html"> fork&amp;exec </a> </li>
        <li> <a href="../../notes/c-tutorials/wait.html"> wait </a> </li>
        <li> <a href="../../notes/c-tutorials/signal.html"> signal </a> </li>
	</ul>
	<h3> I/O and IPC </h3>
	<ul>
        <li> <a href="../../notes/c-tutorials/dup2.html"> dup2 </a> </li>
        <li> <a href="../../notes/c-tutorials/pipe.html"> pipe and dup2 </a> </li>
        <li> <a href="../../notes/c-tutorials/isatty.html"> isatty </a> </li>
	<ul>
	</ul>
	<h3> Timing </h3>
        <li> <a href="../../notes/c-tutorials/times.html"> times </a> </li>
        <li> <a href="../../notes/c-tutorials/gettime.html"> clock_gettime </a> </li>
	<ul>
	<h3> Basics </h3>
	<ul>
        <li> <a href="../../notes/c-tutorials/getopt.html"> Command options </a> </li>
        <li> <a href="../../notes/c-tutorials/strtok.html"> Parsing tokens </a> </li>
<!--
        <li> <a href="../../notes/c-tutorials/fpointer.html"> Pointers to functions </a> </li>
-->
        <li> <a href="../../notes/c-tutorials/list.html"> Linked list </a> </li>
<!--
        <li> <a href="../../notes/c-tutorials/hash.html"> Hash tables </a> </li>
-->
        </ul>

</div>

<div id="sidebar2">
<h1 class="first"> Recommended </h1>
<p>
</p>
<p>
<a href="http://www.amazon.com/exec/obidos/ASIN/020161586X/pkorg/">
<img align="left" width="100" height="138" src="images/practice-of-programming.jpg"
alt="The Practice of Programming"/>
</a>
</p>
<p>
&nbsp;
</p>

<p>
<a href="http://www.amazon.com/exec/obidos/ASIN/0131103628/pkorg/">
<img align="left" width="100" height="132" src="images/c-programming-language.jpg"
alt="The C Programming Language"/>
</a>
</p>
<p>
&nbsp;
</p>

<p>
<a href="http://www.amazon.com/dp/013937681X/pkorg/">
<img align="left" width="100" height="132" src="images/unix-programming-environment.jpg"
alt="The UNIX Programming Environment"/>
</a>
</p>
</div>

</div>
</div>
</body>
</html>
