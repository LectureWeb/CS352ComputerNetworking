<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title> CS 416 Documents </title>
<link href="../../../css/layout.css" rel="stylesheet" type="text/css" />
<link href="../../../css/main.css" rel="stylesheet" type="text/css" />
<link href="../../../css/print.css" rel="stylesheet" type="text/css" media="print" />
<link href="../../../css/main-print.css" rel="stylesheet" type="text/css" media="print" />
<style type="text/css">

#main table.doclist {
	width: 80%;
}
#main .doclist .date, #main .doclist .item {
        vertical-align: baseline; /* for opera */
}
#main .doclist tr {
        vertical-align: baseline;
}
#main .doclist th.item {
        text-align: left;
}
#main .doclist td.item {
        text-align: left;
}
#main a.linksign:link, #main a.linksign:visited, #main a.linksign a:hover {
        text-decoration: none;
}

</style>
</head>
<body id="s_ru416">
<div id="wrapper">
<!-- _______________________________________ BANNER _______________________________________ -->
<div id="banner">
  <div id="logo">
  <img src="../../../css/images/pk-org-pencil.png" alt="pk.org" name="logo" width="122" height="45"/>
  </div>
  <div id="title"> Operating Systems </div>
  <div id="search">
  <form method="get" action="http://www.google.com/search">
	<div style="border:none ;padding:2px;width:25em;">
	<input type="text" name="q" size="25" maxlength="255" value="" />
	<input type="submit" value="Search" />
	<input type="hidden"  name="sitesearch" value="www.pk.org" checked />
	</div>
  </form>
  </div>
  <ul>
    <li class="separator"><a href="../../../about/index.html">About</a></li>
    <li class="separator"><a href="../../../about/contact.html">Contact</a></li>
    <li><a href="../../../sitemap.html">Site map</a></li>
  </ul>
</div>

<!-- _______________________________________ MAIN NAV _______________________________________ -->
<div id="navbar">
	<ul>
	<li class="homelink"><a href="../../../index.html">Home</a></li>
<!--
	<li class="aboutlink"><a href="../../../about/index.html">About</a></li>
-->
	<li class="ru"><a href="../../../rutgers/index.html">Rutgers</a></li>
	<li class="ru352"><a href="../../../352/index.html">Internet Technology [352]</a></li>
	<li class="ru416"><a href="../../../416/index.html">Operating Systems [416]</a></li>
	<li class="ru417"><a href="../../../417/index.html">Distributed Systems [417]</a></li>
	<li class="ru419"><a href="../../../419/index.html">Computer Security [419]</a></li>
	<li class="cslink"><a href="../../../cs/index.html">Computing</a></li>
	<li class="photolink"><a href="../../../photo/index.html">Photography</a></li>
<!--
	<li class="funlink"><a href="#">Coming</a></li>
	<li class="funlink"><a href="#">Soon</a></li>
-->
	</ul>
</div>

<div id="subnav">
<p>
You are in: 
</p>
<ul>
	<li class="first"> <a href="index.html"> Home </a> 
 	<li> <a href="../../../rutgers/index.html"> Rutgers </a> 
 	<li> <a href="../../index.html"> CS 416 </a> 
 	<li> <a href="../../notes/index.html"> Documents </a> 
 	<li> <a href="../../notes/c-tutorials/index.html"> Tutorials </a> 
 	<li> <a href="../../notes/c-tutorials/getopt.html"> Command Line Tutorial </a> 
</ul>
</div>
<div id="content-wrapper">
<div id="main">
<div id="headline">
<h1> C Tutorial: Basics </h1>
</div>

<h1> Processing the command line </h1>
<p>
While many applicaions are graphical and are launched by a window manager on a windowing system,
a great number of applications are designed for use via an interactive command-line shell or
within shell scripts (sequences of commands along with controlling logic). Much of the
appeal and power of the command line is the ability to redirect the output of a command to a file
or to another command via a pipe. For example,
</p>
<div class="codeblock">
	ls &gt;files
</div>
<p>
will create a file named <tt>files</tt> that contains a list of all the files in the current directory
</p>
<div class="codeblock">
	ls | wc -l
</div>
<p>
pipes the output of <em>ls</em> (list files) to <em>wc -l</em>, which counts the number of lines in the 
standard input (the <em>wc</em> command counts characters, words, and lines in a file; the <tt>-l</tt>
option tells it to give just a line count).
</p>
<p>
Most command line programs need to be able to read the parameters given to them on the command line. Parameters
are strings that are separated by white space. The shell is responsible for parsing them into a list, called
an <em>argument list</em>, which is passed to every program via the <em>execve</em> system call and which the
program receives as the arguments to the <em>main</em> function. The shell handles things such as quoted
strings and escaped characters (e.g., escaping a quote or a space to make it part of the argument). Hence,
a command such as:
</p>
<div class="codeblock">
grep -i "my name" file\ 1.txt file\ 2.txt
</div>
<p>
will result in the shell invoking the <em>execve</em> call with the the argument list containing the following
strings:
</p>
<div class="codeblock">
arg[0] = "grep"
arg[1] = "-i"
arg[2] = "my name"
arg[3] = "file 1.txt"
arg[4] = "file 2.txt"
arg[5] = 0
</div>
<p>
The list is an array of pointers. Note that the last element of the list is an entry containing the
number 0, the null pointer. For conveniece, the <em>main</em> function gets invoked with a count of these
arguments as the first parameter and the argument list itself as the second parameter. 
</p>

<h2> Example 1</h2>
<p>
For the simplest example, let's just print each element of the argument list.
</p>

<div class="codeblock-box"><span class="comment">/*
	print the command line arguments

	Paul Krzyzanowski
*/</span>

#include &lt;stdio.h&gt;

int
main(int argc, char **argv)
{
	int i;

	printf("argc = %d\n", argc);
	for (i=0; i&lt;argc; i++) 
		printf("arg[%d] = \"%s\"\n", i, argv[i]);
}
</div>
<p><a href="files/echoargs.c">Download this file</a></p>
<p> Save this file by control-clicking or right clicking the download link and then saving it as <tt>echoargs.c</tt>.</p>
<p> Compile this program via:</p>
<div class="codeblock">
gcc -o echoargs echoargs.c
</div>
<p>If you don't have gcc, You may need to substitute the gcc command with cc or another name of your compiler.</p>
<p>Run the program:</p>
<div class="codeblock">
./echo does she "weigh the same" as\ a duck?
</div>
<p>
You should see:
</p>
<div class="codeblock">
argc = 7
arg[0] = "./echo"
arg[1] = "does"
arg[2] = "she"
arg[3] = "weigh the same"
arg[4] = "as"
arg[5] = "a"
arg[6] = "duck?"
</div>
<p>
The shell did the work of parsing the double quotes aound "weigh the same" to treat that
as a single argument as well as parsing the backslash ('\') as an escape character before the space
to tread "as a" as a single argument.
</p>

<h2> Basic command-line data checking </h2>
<p>
Just using the argc and argv parameters directly is great for simple things. For example,
suppose we write a command that takes two file names (for instance, a copy command). To ensure
that the user entered no more and no less than two names on the command line, we simply check:
</p>
<div class="codeblock">
if (argc != 3) {
	fprintf(stderr, "usage: copy file1 file2\n");
	exit(1);
}
</div>
<p>
Note that we check if <tt>argc</tt> is 3 because the first argument (<tt>argv[0]</tt>) is the name of the command.
Also note that we send the output to <em>stderr</em>, the standard error stream.
This is good practice. Even if the user is redirecting the standard output
of a program, any output to standard error will still go to the command window.
</p>

<h2> Using getopt </h2>
<p>
As you see, the arguments in a command line can comprise anything and it's up to the program
to interpret them as it sees fit.
A convention in most (but not all) Unix system commands is to place various options, or switches,
at the beginning of the command and then the requisite strings or file names after them. The options
are single letters that are prefixed by a hyphen and take a flexible syntax where you can enter the
multiple options together in any order. For instance, these <em>ls</em> commands are all the same (try them):
</p>
<div class="codeblock">
ls -aFilL /etc
ls -a -il -FL /etc
ls -a -i -l -F -L /etc
ls -ailLF /etc
</div>
<p>
Incidentally, these options instruct the <em>ls</em> command to list hidden files, show the file's i-node number,
display the output in long format, follow symbolic links, and place a /, =, *, or @ character after
a filename to identify its type. Run <tt>man ls</tt> to see the manual entry for the <em>ls</em> command.
This  might look horribly cryptic if you're not familiar with UNIX system
commands. The design philosophy was that it's better
for a newbie to struggle a bit and learn than for a skilled user to be forever burdened with verbose commands.
</p>
<p>
We can use the <em>getopt</em> function to help us deal with this sort of parsing of command-line arguments.
The code below illustrates the use of <em>getopt</em> to process a command line that takes the following options:
<ul>
<li> <tt>-d</tt>, <tt>-m</tt>, and <tt>-p</tt> options. The <tt>-d</tt> is treated as a global debug flag. </li>
<li> An optional <tt>-s</tt> followed by a name. </li>
<li> A mandatory <tt>-f</tt> followed by a name. </li>
<li> One or more command line options after all that. </li>
</ul>
<p>
UNIX system manual pages will often summarize the syntax as:
</p>
<div class="codeblock">
getopt [-dmp] [-s <em>name</em>] -f <em>name</em> <em>file</em> [<em>file</em> ...]
</div>
<p>
The elements in brackets mean that they are optional. The <tt>-dmp</tt> means that any combination of
<tt>-d</tt>, <tt>-m</tt>, and <tt>-p</tt> options is allowed.
</p>

<p>
There are
things you need to know about using <em>getopt</em>:
<ul>
<li> Declare <tt> extern char *optarg; extern int optind;</tt> in your function. These are two external variables that
<em>getopt</em> uses. The first, <tt>optarg</tt>, is used when parsing options that take a name as 
a parameter (as <tt>-s</tt> or <tt>-f</tt> in our example). In those cases, it contains a
pointer to that parameter. The second, <tt>optind</tt>, is the current index into the <em>main</em>
function's argument list. It's used to find arguments after all the option processing is done.
</li>

<li><em>getopt</em> takes three parameters. The first two are straight from <em>main</em>:
the argument count and argument list. The third is the one that defines the syntax. It's a 
string that contains all the characters that make up the valid command line options. Any
option that requires a parameter alongside it is suffixed by a colon (<tt>:</tt>).
In our example, we have <tt>"df:mps:"</tt> since we accept command flags of
<tt>-d</tt>, <tt>-f</tt>, <tt>-m</tt>, <tt>-p</tt>, and <tt>-s</tt>. Of these <tt>-f</tt> and
<tt>-s</tt> require parameter. Of these <tt>-f</tt> and
<tt>-s</tt> require a follow-on name.
</li>

<li> <em>getopt</em> is called repeatedly. Each time it is called, it returns the next
command-line option that it found. If theres a follow-on parameter, it is stored in <tt>optarg</tt>.
If <em>getopt</em> encounters an option that's not in the list given to it, it returns a <tt>'?'</tt>
character to signify an error.
If there are no more command-line options found then <em>getopt</em> returns a -1. 
We usually program calls to <em>getopt</em> in a <tt>while</tt> loop with a <tt>switch</tt>
statement within with a case for each option.
</li>

<li>
<p> It's up to you to enforce which options are mandatory and which are optional. You may do this
by setting variables and then checking them when <em>getopt</em> is done processing options. For example,
in the example below we want -f to be mandatory, so we set:
</p>
<div class="codeblock">
fflag = 1;
</div>
<p>
when we encounter the <tt>-f</tt> option and then, after <em>getopt</em> is done, we check:
</p>
<div class="codeblock">
if (fflag == 0) {
	fprintf(stderr, "%s: missing -f option\n", argv[0]);
	fprintf(stderr, usage, argv[0]);
	exit(1)
}
</div>

<li> 
<p>
It's also up to you to enforce if an option is used just once. You usually won't care
but you might want to be extra diligent for options that require parameters. For example, we could
make the code below more robust by checking the following for <tt>-f</tt>:
</p>
<div class="codeblock">
case 'f':
	if (fflag == 1) {
		fprintf("%s: warning:  -f is set multiple times\n");
	}
	fflag = 1;
	fname = optarg;
	break;
</div>
</li>

<li>
When <em>getopt</em> is done, <tt>optind</tt> contains the index of the next command-line argument.
If <tt>optind == argc</tt> then there are no more command-line arguments.
</li>
</ul>
<h2> Example 2</h2>
<p>
Here's the sample program:
</p>

<div class="codeblock-box"><span class="comment">/*
	example of command line parsing via getopt
	usage: getopt [-dmp] -f fname [-s sname] name [name ...]

	Paul Krzyzanowski
*/</span>

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

int debug = 0;

int
main(int argc, char **argv)
{
	extern char *optarg;
	extern int optind;
	int c, err = 0; 
	int mflag=0, pflag=0, fflag=0;
	char *sname = "default_sname", *fname;
	static char usage[] = "usage: %s [-dmp] -f fname [-s sname] name [name ...]\n";

	while ((c = getopt(argc, argv, "df:mps:")) != -1)
		switch (c) {
		case 'd':
			debug = 1;
			break;
		case 'm':
			mflag = 1;
			break;
		case 'p':
			pflag = 1;
			break;
		case 'f':
			fflag = 1;
			fname = optarg;
			break;
		case 's':
			sname = optarg;
			break;
		case '?':
			err = 1;
			break;
		}
	if (fflag == 0) {	<span class="comment">/* -f was mandatory */</span>
		fprintf(stderr, "%s: missing -f option\n", argv[0]);
		fprintf(stderr, usage, argv[0]);
		exit(1);
	} else if ((optind+1) &gt; argc) {	
		<span class="comment">/* need at least one argument (change +1 to +2 for two, etc. as needeed) */</span>

		printf("optind = %d, argc=%d\n", optind, argc);
		fprintf(stderr, "%s: missing name\n", argv[0]);
		fprintf(stderr, usage, argv[0]);
		exit(1);
	} else if (err) {
		fprintf(stderr, usage, argv[0]);
		exit(1);
	}
	<span class="comment">/* see what we have */</span>
	printf("debug = %d\n", debug);
	printf("pflag = %d\n", pflag);
	printf("mflag = %d\n", mflag);
	printf("fname = \"%s\"\n", fname);
	printf("sname = \"%s\"\n", sname);
	
	if (optind &lt; argc)	<span class="comment">/* these are the arguments after the command-line options */</span>
		for (; optind &lt; argc; optind++)
			printf("argument: \"%s\"\n", argv[optind]);
	else {
		printf("no arguments left to process\n");
	}
	exit(0);
}
</div>
<p><a href="files/getopt.c">Download this file</a></p>
<p> Save this file by control-clicking or right clicking the download link and then saving it as <tt>getopt.c</tt>.</p>
<p> Compile this program via:</p>
<div class="codeblock">
gcc -o getopt getopt.c
</div>
<p>Run the program and try various permutations of options. Some valid ones:</p>
<div class="codeblock">
./getopt -dp -f test -s "more stuff" blah
./getopt -f test -d -p blah
./getopt -f test blah
</div>
<p>Some invalid ones: </p>
<div class="codeblock">
./getopt -dpq -f test -s "more stuff" blah
./getopt -f test -d -p blah blah blah
./getopt -f 
</div>

</div>
<div id="footer">
<hr/>
<style type="text/css">  
span.codedirection { unicode-bidi:bidi-override; direction: rtl; }  
</style>  

<p> &copy; 2003-2019 Paul Krzyzanowski. All rights reserved.</p>
<p>For questions or comments about this site, contact Paul Krzyzanowski, 
<span class="codedirection">gro.kp@ofnibew</span>
</p>
<p>
The entire contents of this site are protected by copyright under national and international law.
No part of this site may be copied, reproduced, stored in a retrieval system, or transmitted, in any form,
or by any means whether electronic, mechanical or otherwise without the prior written
consent of the copyright holder.
If there is something on this page that you want to use, please let me know.
</p>
<p>
Any opinions expressed on this page do not necessarily reflect the opinions of my employers and may not
even reflect my own.
</p>
<p> Last updated: March 28, 2019
</p>
<img class="stamp" src="../../..//css/images/recycled_pixels_logo.png" alt="recycled pixels" height="80" width="80" />
</div> <!-- footer -->
<div id="tear">
</div>


<div id="sidebar1">
<h1 class="first">Contents </h1>
	<h2> CS 416 </h2>
	<ul>
	<li> <a href="../../index.html"> Main course page </a> </li>
	<li> <a href="../../news.html"> News </a> </li>
	<li> <a href="../../syllabus.html"> Syllabus </a> </li>
	<li> <a href="../../hw/index.html"> Homework </a> </li>
	<li> <a href="../../notes/index.html"> Documents </a> </li>
	<li> <a href="../../exam/index.html"> Exam info </a> </li>
	<li> <a href="../../grades/index.html"> Check your grades </a> </li>
	<li> <a href="https://sakai.rutgers.edu/portal"> Sakai </a> </li>
	</ul>

        <h2> Tutorials </h2>
        <ul>
        <li> <a href="../../notes/c-tutorials/index.html"> C/Unix tutorials </a> </li>
        <li> <a href="../../notes/make/index.html"> Makefile tutorial </a> </li>
        <li> <a href="../../notes/sockets/index.html"> TCP/IP Sockets </a> </li>
        <li> <a href="../../notes/rpc/index.html"> ONC RPC tutorial </a> </li>
<!--
        <li> <a href="../../notes/clocks/index.html"> Clocks demo </a> </li>
-->
        </ul>

	
        <h2> <a href="index.html">C Tutorials</a> </h2>
	<h3> Processes </h3>
        <ul>
        <li> <a href="../../notes/c-tutorials/getpid.html"> getpid </a> </li>
        <li> <a href="../../notes/c-tutorials/getppid.html"> getppid </a> </li>
        <li> <a href="../../notes/c-tutorials/fork.html"> fork </a> </li>
        <li> <a href="../../notes/c-tutorials/exec.html"> exec </a> </li>
        <li> <a href="../../notes/c-tutorials/forkexec.html"> fork&amp;exec </a> </li>
        <li> <a href="../../notes/c-tutorials/wait.html"> wait </a> </li>
        <li> <a href="../../notes/c-tutorials/signal.html"> signal </a> </li>
	</ul>
	<h3> I/O and IPC </h3>
	<ul>
        <li> <a href="../../notes/c-tutorials/dup2.html"> dup2 </a> </li>
        <li> <a href="../../notes/c-tutorials/pipe.html"> pipe and dup2 </a> </li>
        <li> <a href="../../notes/c-tutorials/isatty.html"> isatty </a> </li>
	<ul>
	</ul>
	<h3> Timing </h3>
        <li> <a href="../../notes/c-tutorials/times.html"> times </a> </li>
        <li> <a href="../../notes/c-tutorials/gettime.html"> clock_gettime </a> </li>
	<ul>
	<h3> Basics </h3>
	<ul>
        <li> <a href="../../notes/c-tutorials/getopt.html"> Command options </a> </li>
        <li> <a href="../../notes/c-tutorials/strtok.html"> Parsing tokens </a> </li>
<!--
        <li> <a href="../../notes/c-tutorials/fpointer.html"> Pointers to functions </a> </li>
-->
        <li> <a href="../../notes/c-tutorials/list.html"> Linked list </a> </li>
<!--
        <li> <a href="../../notes/c-tutorials/hash.html"> Hash tables </a> </li>
-->
        </ul>

</div>

<div id="sidebar2">
<h1 class="first"> Recommended </h1>
<p>
</p>
<p>
<a href="http://www.amazon.com/exec/obidos/ASIN/020161586X/pkorg/">
<img align="left" width="100" height="138" src="images/practice-of-programming.jpg"
alt="The Practice of Programming"/>
</a>
</p>
<p>
&nbsp;
</p>

<p>
<a href="http://www.amazon.com/exec/obidos/ASIN/0131103628/pkorg/">
<img align="left" width="100" height="132" src="images/c-programming-language.jpg"
alt="The C Programming Language"/>
</a>
</p>
<p>
&nbsp;
</p>

<p>
<a href="http://www.amazon.com/dp/013937681X/pkorg/">
<img align="left" width="100" height="132" src="images/unix-programming-environment.jpg"
alt="The UNIX Programming Environment"/>
</a>
</p>
</div>

</div>
</div>
</body>
</html>
