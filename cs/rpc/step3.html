<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title> CS 417 Documents </title>
<link href="../../css/layout.css" rel="stylesheet" type="text/css" />
<link href="../../css/main.css" rel="stylesheet" type="text/css" />
<link href="../../css/print.css" rel="stylesheet" type="text/css" media="print" />
<link href="../../css/main-print.css" rel="stylesheet" type="text/css" media="print" />
<style type="text/css">

#main table.doclist {
	width: 80%;
}
#main .doclist .date, #main .doclist .item {
        vertical-align: baseline; /* for opera */
}
#main .doclist tr {
        vertical-align: baseline;
}
#main .doclist th.item {
        text-align: left;
}
#main .doclist td.item {
        text-align: left;
}
#main a.linksign:link, #main a.linksign:visited, #main a.linksign a:hover {
        text-decoration: none;
}

</style>
</head>
<body id="s_cs">
<div id="wrapper">
<!-- _______________________________________ BANNER _______________________________________ -->
<div id="banner">
  <div id="logo">
  <img src="../../css/images/pk-org-pencil.png" alt="pk.org" name="logo" width="122" height="45"/>
  </div>
  <div id="title"> Distributed Systems </div>
  <ul>
    <li class="separator"><a href="../../about/index.html">About</a></li>
    <li class="separator"><a href="../../about/contact.html">Contact</a></li>
    <li><a href="../../sitemap.html">Site map</a></li>
  </ul>
</div>

<!-- _______________________________________ MAIN NAV _______________________________________ -->
<div id="navbar">
	<ul>
	<li class="homelink"><a href="../../index.html">Home</a></li>
<!--
	<li class="aboutlink"><a href="../../about/index.html">About</a></li>
-->
	<li class="ru"><a href="../../rutgers/index.html">Rutgers</a></li>
	<li class="ru416"><a href="../../416/index.html">Operating Systems [416]</a></li>
	<li class="ru417"><a href="../../417/index.html">Distributed Systems [417]</a></li>
	<li class="cslink"><a href="../../cs/index.html">Computing</a></li>
	<li class="photolink"><a href="../../photo/index.html">Photography</a></li>
<!--
	<li class="funlink"><a href="#">Coming</a></li>
	<li class="funlink"><a href="#">Soon</a></li>
-->
	</ul>
</div>

<div id="subnav">
<p>
You are in: 
<ul>
	<li class="first"> <a href="index.html"> Home </a> 
 	<li> <a href="../index.html"> Computing </a> 
 	<li> <a href="../rpc/index.html"> RPC Tutorial </a> 
</ul>
</p>
</div>
<div id="content-wrapper">
<div id="main">
<div id="headline">
<h1> Introduction to programming with Sun/ONC RPC: step 3 </h1>
</div>

<table>
<tr> <td> <a href="index.html">Step 1</a></td>
<td> <a href="step2.html">Step 2</a></td>
<td class="inverse"> <a href="step3.html">Step 3</a></td>
<td> <a href="step4.html">Step 4</a></td>
<td> <a href="step5.html">Step 5</a></td>
<td> <a href="step6.html">Step 6</a></td></tr>
</table>

<h2>Step 3. First test of the client and server </h2>

<p>
The template code written by <i>rpcgen</i> created a client
program named <tt>add_client.c</tt> that accepts a single
argument on the command line
containing the name of the server, creates an RPC handle to the 
server process, and calls the <i>add_1</i> function. A client
template for an interface with more functions would contain
a declaration of parameters and return values for each of
the functions and call them one after the other.
</p>
<p>
The server function, contained in <tt>add_server.c</tt> is
a function which does nothing but
contains the comments:
</p>
<div class="codeblock-box">
/*
 * insert server code here
 */
</div>

<p>
We will replace those comments with a single print statement:
</p>
<div class="codeblock-box">
printf("add function called\n");
</div>
<p>
<em>Important!</em><br/>
Before we compile, we will make a change to the makefile. We will make
sure that the server is compiled so that the symbol <tt>RPC_SVC_FG</tt>
is defined. This will cause our server to run in the foreground.
For testing purposes, this is convenient since we'll be less likely
to forget about it and it will be easier to kill (we don't have to look
up its process ID).
</p>
<p>
Edit the makefile and find the line that defines <tt>CFLAGS</tt>:
<div class="codeblock">
CFLAGS += -g
</div>
<p>
and change it to:
</p>
<div class="codeblock">
CFLAGS += -g -DRPC_SVC_FG
</div>
<p>
Secondly, we want to make sure that <i>rpcgen</i> generates code that
conforms to ANSI C, so we'll add a -C (capital C) parameter to the <i>rpcgen</i>
command. Change the line in the makefile that defines:
</p>
<div class="codeblock">
RPCGENFLAGS =
</div>
<p>
to:
</p>
<div class="codeblock">
RPCGENFLAGS = -C
</div>
<p>
Now compile your program by running <i>make</i>. You'll see output
similar to:
</p>
<div class="codeblock">
cc -g -DRPC_SVC_FG -c -o add_clnt.o add_clnt.c 
cc -g -DRPC_SVC_FG -c -o add_client.o add_client.c
cc -g -DRPC_SVC_FG -c -o add_xdr.o add_xdr.c
cc -g -DRPC_SVC_FG -o add_client add_clnt.o add_client.o add_xdr.o -lnsl
cc -g -DRPC_SVC_FG -c -o add_svc.o add_svc.c
cc -g -DRPC_SVC_FG -c -o add_server.o add_server.c 
cc -g -DRPC_SVC_FG -o add_server add_svc.o add_server.o add_xdr.o -lnsl
</div>
<p>
Note that the <tt>-lnsl</tt> argument is not needed when linking under
Linux, *BSD, or OS X.
</p>
<p>
If you're running OS X, Linux, or BSD and don't have a makefile, run
the above commands using gcc as the compiler and omitting -lnsl:
</p>
<div class="codeblock">
gcc -g -DRPC_SVC_FG -c -o add_clnt.o add_clnt.c
gcc -g -DRPC_SVC_FG -c -o add_client.o add_client.c
gcc -g -DRPC_SVC_FG -c -o add_xdr.o add_xdr.c
gcc -g -DRPC_SVC_FG -o add_client add_clnt.o add_client.o add_xdr.o 
gcc -g -DRPC_SVC_FG -c -o add_svc.o add_svc.c
gcc -g -DRPC_SVC_FG -c -o add_server.o add_server.c
gcc -g -DRPC_SVC_FG -o add_server add_svc.o add_server.o add_xdr.o 
</div>
<p>
Unfortunately, the compilation produces a number of warnings but you can
ignore them.
</p>
<p>
The result is that you have two executables: <i>add_client</i> and
<i>add_server</i>. You can move <i>add_server</i> to another machine
or run it locally, giving <i>add_client</i> your local machine's name
or the name <tt>localhost</tt>.
</p>
<p>
If you're running this on a non-SunOS machine, you may need to 
start the RPC port mapper first. Chances are you won't and you
should try running the server first. If it does not exit
immediately with an <code>unable to register</code> error, you're
probably good to go. If you do need to start the portmapper then
here are the commands that you'll
need to run on several popular operating systems:
</p>
<table>
<tr> <td align=center> <i>OS</i> </td> <td> command </td> </tr>
<!--
<tr> <td> Mac OS X Tiger </td> <td> <pre>launchd portmap</pre> </td> </tr>
<tr> <td> Mac OS X Leopard</td> <td> <pre>/usr/sbin/portmap</pre> </td> </tr>
-->
<tr> <td> Mac OS X </td> <td> <pre> launchctl start com.apple.portmap </pre> </td> </tr>
<tr> <td> Linux </td> <td> <pre>/sbin/portmap</pre> </td> </tr>
<tr> <td> *BSD </td> <td> <pre>/usr/sbin/rpcbind</pre> </td> </tr>
</table>
<p>
In one window, run:
</p>
<div class="codeblock">
./add_server
</div>
<p>
If you're on OS X Leopard, you'll need to be root to start the server. Either <code>su</code>
and get a root shell or run:
</p>
<div class="codeblock">
sudo ./add_server
</div>
<p>
In another window, run:
</p>
<div class="codeblock">
./add_client localhost
</div>
<p>
In the server window, you should see the following text appear:
</p>
<div class="codeblock">
add function called
</div>
<p>
This confirms that the client and server are communicating. If your client
just seems to be hanging, chances are you have not started the portmapper.
</p>

<h3> <a href=step4.html>Continue to step 4</a></h3>
<h3> <a href=step2.html>Back to step 2</a></h3>
</div>
<div id="footer">
<hr/>
<style type="text/css">  
span.codedirection { unicode-bidi:bidi-override; direction: rtl; }  
</style>  

<p> &copy; 2003-2011 Paul Krzyzanowski. All rights reserved.</p>
<p>For questions or comments about this site, contact Paul Krzyzanowski, 
<span class="codedirection">gro.kp@ofnibew</span>
</p>
<p>
The entire contents of this site are protected by copyright under national and international law.
No part of this site may be copied, reproduced, stored in a retrieval system, or transmitted, in any form,
or by any means whether electronic, mechanical or otherwise without the prior written
consent of the copyright holder.
If there is something on this page that you want to use, please let me know.
</p>
<p>
Any opinions expressed on this page do not necessarily reflect the opinions of my employers and may not
even reflect mine own.
</p>
<p> Last updated: January 21, 2011
</p>
<img class="stamp" src="../..//css/images/recycled_pixels_logo.png" alt="recycled pixels" height="80" width="80" />
</div> <!-- footer -->
<div id="tear">
</div>


<div id="sidebar1">
<h1 class="first">Contents </h1>
	<h2> <a href="#distributed_computing">Distributed Computing</a> </h2>
	<h2> <a href="#computer_security">Computer Security</a> </h2>
	<h2> <a href="#tutorials">Tutorials</a> </h2>
	<ul>
	<li> <a href="../rutgers/notes/make/index.html"> Makefiles </a> </li>
	<li> <a href="../rutgers/notes/sockets/index.html"> Sockets </a> </li>
	<li> <a href="../rpc/index.html"> RPC </a> </li>
	</ul>
	<h2> <a href="#miscellany">Miscellany</a> </h2>
	<ul>
	<li> <a href="../misc/Cstyle.pdf"> C programming style </a> </li>
	<li> <a href="../misc/osx-space.html"> Freeing space on OS X </a> </li>
	<li> <a href="../misc/osx-setup.html"> Configuring OS X  </a> </li>
	</ul>
</div>

<div id="sidebar2">
<h1 class="first"> ***** </h1>
<p> Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh </p>
<h2> Duis ultrices dolor sed erat. </h2>
<p>Praesent ultrices, turpis vel feugiat tristique, mauris ligula pellentesque urna, quis interdum est enim mollis sem. </p>
<p> Ellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Praesent orci leo, suscipit vel, pretium eu, viverra at, eros. Morbi cursus. </p>
</div>

</div>
</div>
</body>
</html>
