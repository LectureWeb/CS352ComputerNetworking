<!DOCTYPE HTML>
<!--
	Paul Krzyzanowski pk.org
	Derived from Editorial by HTML5 UP html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Malware</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="../../assets/css/main-article.css?v=1.3"/> <link rel="stylesheet" href="../../assets/css/ru-info.css?v=1.0" />
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Main -->
					<div id="main">
						<div class="inner">

							<!-- Header -->
							<header id="header">
								<a href="../index.html" class="logo"><strong>Computer Security</strong>: Paul Krzyzanowski</a>
<!--
								<ul class="icons noprint">
									<li><a href="http://www.twitter.com/@p_k" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
									<li><a href="https://www.facebook.com/paul.krzyzanowski" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
									<li><a href="#" class="icon brands fa-snapchat-ghost"><span class="label">Snapchat</span></a></li>
									<li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
								</ul>
-->
							</header>

							<!-- Content -->
							<section>
								<header class="main">
								<h1>Malware</h1>
								<h2>Malicious software and what to do about it</h2>

								<p>Paul Krzyzanowski</p>
								<p>October 11, 2020</p>
								</header>
							</section>
							
							<section id="bodytext">
								<h1 id="malware">Malware</h1>

<p><strong>Malware</strong> is a term that refers to any malicious software that is unintentionally installed on a computer system.
Malware can be distributed in various ways: viruses, worms, unintentional downloads, or trojan horses. It may spy on user actions and collect information on them (<strong>spyware</strong>), or present unwanted ads (<strong>adware</strong>). It may disable components of the system or encrypt files, undoing its damage if the owner pays money (<strong>ransomware</strong>).
The software may sit dormant and wait for directives from some coordinator (a <strong>command and control server</strong>), who assembled an arsenal of hundreds of thousands of computers ready to do its bidding (for example, launch a <strong>distributed denial of service</strong>, <strong>DDoS</strong>, attack). Some software might be legitimate but may contain <strong>backdoors</strong> &#8211; undocumented ways to allow an outsider to use that software to perform other operations on your system.</p>

<h2 id="malwaremotivation">Malware Motivation</h2>

<p>A saying often paraphrased from Sun Tzu&#8217;s <em>The Art of War</em> is <em>&#8220;know your enemy.&#8221;</em> In the case of malware, it helps to understand why someone would want to install malicious software on your computer. There are numerous reasons. We examined this in greater detail at the start of the course. Some of the reasons are:</p>
<dl>
<dt>Steal account credentials</dt>
<dd>If an attacker can obtain someone’s login and password credentials on one system, there is a good chance that those same credentials will work on other systems.</dd>

<dt>Espionage</dt>
<dd>An attacker may have an interest in spying on the activities of a particular person. Traditionally, this would have been done through planting covert cameras and recording devices. Now it is often easier to accomplish the same results - and more - by installing software on the target’s computer. Such software is called <strong>spyware</strong>.</dd>

<dt>Data theft</dt>
<dd>An attacker may target a person at a specific company (or a student taking a certain class) in an attempt to <strong>exfiltrate</strong> data of strategic interest. Alternatively, an attacker may target people anonymously, with the hope of obtaining information of value, such as credit card data or bank account information.</dd>

<dt>Sabotage</dt>
<dd>There’s vengeance or vandalism: the attacker may want to destroy a target’s content or devices.</dd>

<dt>Host services</dt>
<dd>An attacker may need to harness computing, storage, or network resources. This can help hide the owner’s identity or amass a large collection of computers. An attacker can set up servers to host contraband data (e.g., stolen credit cards, login credentials, illegal material), send spam email on a large scale, mine cryptocurrency for free, or create a botnet for DDoS (distributed denial of service) attacks.</dd>

<dt>Adware and ad clicking</dt>
<dd>An attacker may add software to a system or reconfigure a browser or hosts file to present unwanted advertising in the form of pop-up windows or banners. Additionally, the malware may redirect search requests or create click-throughs on ads that the user never wanted.</dd>

<dt>Ransomware</dt>
<dd>Finally, the attacker may want to extract money from the victim directly. Ransomware installs software to encrypt files that will be (hopefully) decrypted if ransom is paid. The emergence of cryptocurrencies led to a huge increase in ransomware since they enabled anonymous payments. Ransomware is a reversible form of sabotage coupled with extortion.</dd>
</dl>


<p>Another saying paraphrased from <em>The Art of War</em> is <em>&#8220;all warfare is based on deception.&#8221;</em> This is also useful to consider with malware since it is most often installed willingly by the user of the system via some form of deception rather than through the exploitation of bugs in the system.</p>

<h2 id="malwareinfiltration">Malware Infiltration</h2>

<p>There are several ways in which malware gets onto a system.</p>

<p>An attacker can exploit vulnerabilities in system services, particularly network services, to inject code that will download the malware. <strong>Zero-day vulnerabilities</strong> are particularly useful to attackers. These are bugs that have been discovered but not yet reported to the software vendor or the general public and hence are not fixed. They are typically known only to those who discovered and exploited the vulnerability &#8230; or sold the exploit.</p>

<p>As such, an attacker can be confident that the exploit will work on virtually all systems running the software and does not have to rely on targets who were not diligent enough to keep their systems patched. Ideally (for the attacker), the vulnerabilities will allow malware to run with elevated privileges so they can access all parts of a system or conceal itself more effectively.</p>

<p>Related to this are <strong>N-day vulnerabilities</strong>. N-day vulnerabilities are known vulnerabilities. Because they are known, developers have the opportunity to patch the code with a fix and IT administrators have the ability to apply a patch, shut off services, or put some detection mechanisms in place. However, all this does not happen instantly. Attackers have a period of time &#8212; N days &#8212; between the time that a vulnerability is disclosed and the time that most systems have been patched to avoid the vulnerability.</p>

<p>Malware might be installed unknowingly via infected removable media, most commonly USB flash drives (in earlier years, it would have been CDs or floppy disks). </p>

<h3 id="socialengineering">Social engineering</h3>

<p>By far the most common way that malware enters a system is via deception: the legitimate user of the system installed it unknowingly. This uses a <strong>social engineering</strong> attack to convince the user that it is in his or her interest to install the software.</p>

<p>Social engineering is the art of manipulating, influencing, or deceiving a user into taking some action that is not in his/her or the organization&#8217;s best interest. Goal of social engineers is to obtain your trust and get you to divulge information or provide them with some form of access. In computers, social engineering refers to any techniques used by an adversary to trick you into disclosing information, opening a file, downloading an attachment, reading a message, or running a program.</p>

<p>Websites may offer downloads of &#8220;security&#8221; software, system &#8220;cleaner&#8221; software, or software &#8220;updates,&#8221; none of which will do their purported task. An attacker may convince a user to click on a URL in an email attachment or a web page. Software obtained from file sharing services are also excellent venues for distributing malware. A user may try to avoid spending $4,000 for an AutoCAD license or $240/year for an Adobe Illustrator license and turn to a file sharing site to download a patched copy or a crack for the software that bypasses license checks. Quite often, these downloads contain malware instead of the desired software (what do you expect &#8211; the user is acting as a thief by downloading software from thieves).</p>

<p>An attacker may search collections of stolen email addresses (or usernames) and passwords. Since people often use the same name and password on multiple systems, this can often give the attacker access to other websites on which the user has accounts. Accounts for banking sites are, of course, particularly valuable since they can be a direct conduit for transferring money. </p>

<p>Given login information about a user, an attacker can log onto the systems or services as the owner of the account and install malware, monitor the internal organization, and even send email (e.g., contact other employees or friends).</p>

<p>Any information the attacker can get about a user can help an attacker create a more convincing social attack. The term <strong>pretexting</strong> refers to using a concocted scenario to contact a user and get additional information (e.g., an attacker can pretend to be a caller from the IT department or a high-level manager from another location to try to extract information; with some rudimentary information, the attacker can mention some employee, department, or project names to sound like a true insider).</p>

<h2 id="typesofmalware">Types of Malware</h2>

<h3 id="wormsandviruses">Worms and viruses</h3>

<p>A <strong>virus</strong> is software that attaches itself to another piece of software. It may
also be content, such as scripts inside a Microsoft Word document or PDF file, that will be accessed and hence executed by some software. It may also be an email attachment that contains a document or software with the malware or a link to the malware.</p>

<p>It might even be a modification of the boot loader
of a computer or the firmware on a flash drive. The key point is that it does
not run as an independent process. A virus may spread automatically by trying to </p>

<p>A virus is executed because another program ran.
Viruses are often spread by sharing files or software. On a computer, a virus may replicate itself onto other files or software to maximize its chance of spreading and reduce its chance of being removed.</p>

<p>A <strong>worm</strong> is conceptually similar in that it can do the same damage to the computer as a virus can. The distinction from a virus is that <strong>a worm runs as a standalone
process while a virus requires a host program</strong>.</p>

<p>Worms and virus are both designed to propagate to other computers, although they
may require human intervention to spread. In other cases,
they can replicate themselves and spread to other systems automatically, exploiting
weaknesses in software on those computers to allow themselves to infiltrate those
machines. The popular use of both terms, <em>worm</em> and <em>virus</em>, has often blurred
the distinctions between them. People often refer to any malware as a virus.</p>

<p>When using non-legitimate ways of getting into a system or elevating their privileges, attackers often try to find <strong>zero-day vulnerabilities</strong>. These are vulnerabilities (bugs or configuration errors) that have not been publicly reported, or are newly discovered, and hence are unpatched. They are referred to as &#8220;zero-day&#8221; because developers have zero days to fix the problem.</p>

<h3 id="virusandwormcomponents">Virus and worm components</h3>

<p>Viruses and worms contains three components:</p>
<dl>
<dt><strong>Infection mechanism</strong></dt>
<dd>The infection mechanism is the component of a worm or virus that enables it to spread. It can exploit software vulnerabilities to connect to other systems, patch certain files, or alter start-up scripts.</dd>

<dt><strong>Payload</strong></dt>
<dd>This is the malicious part of the virus and contains the code that does
the actual harm to the system such as uploading personal information or deleting files. In some cases, the payload may be a generic service that contacts a <strong>command and control</strong> server from which it gets specific instructions on what to do (e.g., mine cryptocurrency, send spam, participate in a DDoS attack).</dd>

<dt><strong>Trigger</strong></dt>
<dd>The trigger, also called a <strong>logic bomb</strong>, is code that is run
whenever a file containing the virus is run. It makes the decision
whether the payload should be executed. For example, some viruses
may stay dormant until a particular date, number of runs, or upon getting directives from a command and control server.</dd>
</dl>


<h2 id="malwareresidence:wheredoesitlive">Malware residence: where does it live?</h2>

<h3 id="fileinfectorvirus">File infector virus</h3>

<p>A <strong>file infector</strong> virus is a virus that adds itself to an executable program. The virus patches the program so that, upon running, control will flow to the the virus code. Ideally, the code will install itself in some unused area of the file so that the file length will remain unchanged. A comparison of file sizes with the same programs on other systems will not reveal anything suspicious. When the virus runs, it will run the <em>infector</em> to decide whether to install itself on other files. The <em>trigger</em> will then decide whether the <em>payload</em> should be executed. If not, the program will appear to run normally.</p>

<h3 id="bootloadermalware">Bootloader malware</h3>

<p><strong>Bootkits</strong>, also known as <strong>boot sector viruses</strong>, are malware that targets the booting process of a system. The malware has an infector that installs itself in the
Master Boot Record (MBR) of a disk. In older BIOS-based PC systems, the first
sector of the bootable storage device is read into memory and executed
when the system boots, Normally, the code that is loaded is the
boot loader that then loads the operating system. By infecting the master
boot record, the virus can repeatedly re-infiltrate the operating system or files
on the disk even if any malware on the system was previously detected and removed.</p>

<p>Boot sector viruses were common in the early days of PCs when users often
booted off floppy disks and shared these disks. The virus would often use
DOS commands to install itself onto other disks that it detects. Users on those systems had full administrative rights to modify any part of the system.</p>

<p>These viruses have diminished as attackers found more appealing targets.
However, attacks on the bootloader are a continued threat.
2011 saw the emergence of <em>ransomware</em> that modified the boot loader
to prevent the operating system from booting unless a ransom was paid.
In 2016, <em>Petya Trojan</em> ransomware was deployed, which also infects the MBR and encrypts disk contents. </p>

<h3 id="infectedflashdrives">Infected flash drives</h3>

<p>In the early days of PCs, people would share content by passing around floppy disks. This became a means for viruses to spread, which could be planted in either the boot sector or in files. These days, people share USB flash drives the way they used to share floppies.</p>

<h4 id="autorun">Autorun</h4>

<p>In earlier Windows systems, Microsoft provided a feature called <strong>AutoRun</strong>.
It was designed to make the CD (and, later, DVD and flash drive) experience better for users, particularly when using CDs for software installation. If the CD contained a file called <code>autorun.inf</code>, Windows would automatically execute a program identified within that file. While this made the experience of figuring out what to do after a CD is inserted easier for most users, it created a horrific security vulnerability: all that an adversary had to do was to get you to insert the media. Moreover, this functionality worked with any removable storage so that inserting a flash drive would automatically run a program defined
within <code>autorun.inf</code> on the drive.</p>

<p>Microsoft eventually removed this capability from flash drives but some manufacturers created USB drives that emulated a CD drive to
offer the &#8220;convenience&#8221; of AutoRun.
Microsoft ultimately removed this functionality altogether in Windows 7. However, there are still old, unpatched versions
of Windows out there that can be exploited with this vulnerability.</p>

<p>A similar problem occurs in the KDE framework. KDE is a desktop environment widely
used on Linux systems. Malicious <code>.desktop</code> and <code>.directory</code> files can be created
to run malicious code.
Whenever the user uses the KDE file viewer to navigate to the directory where these files are stored, the
code contained within these files will execute without any user interaction.
This problem has not been fixed as of August 2019.</p>

<h4 id="usbfirmware">USB Firmware</h4>

<p>The more insidious problem with USB flash drives now is unprotected firmware.
A USB flash drive is a bunch of memory as well as firmware &#8211; embedded software
on the chip. The firmware runs when you plug the drive into your computer.
It identifies the drive as a USB storage device and manages the transferring
of data. You don&#8217;t see this firmware and cannot tell if it has been changed.
Because the firmware defines what the USB device is, modified firmware on the
flash drive could present the drive as a keyboard and send a set of keyboard
commands to the host system (for example, commands to open the terminal window
and delete files). </p>

<p>A USB device can have multiple profiles associated
with it and thus present itself as multiple devices, so the
flash drive can tell the computer it is a keyboard but also a flash drive, so the
user will still be able to use the device as a storage device.
The firmware could also modify file contents as they pass
between the USB storage device and host computer. The same attack can
be user on other USB devices. For example, an ethernet adapter can redirect
network messages to an attacker&#8217;s site.</p>

<p>Reprogramming the firmware has not been exploited by malware thus far, at least not in a
widespread manner, but
the vulnerability has been demonstrated and the <a href="https://github.com/brandonlw/Psychson">source code</a> to do this is freely and readily available.</p>

<h4 id="dataleakage">Data leakage</h4>

<p>The most common problem with flash drives is their portability
and small size: they are easy to lose and easy to borrow. This
makes them vulnerable to <strong>data leakage</strong>, which is just a fancy
term that means some adversary may access your data simply by
borrowing your flash drive.</p>

<p>In 2016, researchers at the University of Illinois ran an experiment where they scattered nearly 300 USB drives in public areas through the campus. Each of those drives was loaded with files that, when opened on a network-connected computer, would contact a server to tell it that the drive has been picked up and the file was opened. The results of the study showed that 98% of the drives were picked up and someone opened up at least one file on 45% of them<a href="#fn:1" id="fnref:1" title="see footnote" class="footnote">[1]</a>. Because of the risk of malicious firmware, even formatting a drive does not make it safe to use.</p>

<h3 id="inadvertentprogramexecution">Inadvertent program execution</h3>

<p>The portability of flash drives makes them a distribution mechanism. Experiments of scattering a number of them in parking lots revealed that many people are all too willing to plug a random drive into their system.</p>

<p>Even without automatic execution capabilities enabled, attackers can use flash drives as a distribution mechanism for malware. The Stuxnet attack exploited a windows bug in rendering shortcut icons where just viewing them in Windows Explorer enabled the execution of arbitrary code. Others have exploited a bug in video playback that allowed code execution. Even something as simple as an HTML file on a drive may direct the target to a website that can launch an attack.</p>

<p>There are many other USB device-based attacks. Take a look <a href="https://www.bleepingcomputer.com/news/security/heres-a-list-of-29-different-types-of-usb-attacks/">here</a> if you&#8217;re curious.</p>

<h3 id="macroviruses">Macro viruses</h3>

<p>Some applications have support for <strong>macros</strong>, which allow the user to
define a set of commands to
avoid repetitive tasks and improve productivity.
They are particularly common in text editors but are present in other
applications as well, such as Photoshop and Microsoft Word and Excel.
In some cases, as with Microsoft Office applications, macros are embedded in
the document, which means they can be passed on to other users who access
that document. Some macro capabilities are far more powerful than simply defining
repetitive commands. Microsoft Office products, for example, provide
Visual Basic scripting, which effectively allows users to embed complete
programs into their documents. VBScript is based on Visual Basic and provides features that make it easy to access network printers, network files, special folders, user information, and even execute scripts on remote systems.</p>

<p>Scripts in Office documents can spread not only by having the user pass the original infected
document around but by modifying the
default template file, <code>normal.dot</code>. This will affect every
other document on the system.
With operating systems providing better access controls and users not running with administrative privileges, embedded scripts are a ripe area for attack. If you can
convince somebody to open a document, they will run your program on their
machine. </p>

<p>The challenge, of course, is to get a file with a malicious macro to target
users and get them to open it. One of the most common techniques is to
send it as an email attachment with some inducement to get the user to
click on the document. This is an example of <strong>social engineering</strong>.</p>

<p>One hugely-successful virus that did this
was the ILOVEYOU virus from 2000. The subject of the message stated that
it is a letter from a secret admirer. The attachment wasn&#8217;t even a document;
it was a visual basic script. To provide a better user experience, Microsoft
would hide file extensions by default (macOS does this too). The file was
named <code>LOVE-LETTER-FOR-YOU.TXT.vbs</code> but the <code>.vbs</code> suffix, which
indicated that the file was a visual basic script, was hidden from users, so
they only saw <code>LOVE-LETTER-FOR-YOU.TXT</code>. Not being aware of when extensions
are hidden and when they are not, millions of users assumed they received
an innocuous text file and clicked on it. Upon execution, the script would
copy itself into various folders, modify and add new entries to the system registry,
replace various types of files with copies of itself (targeting music and
video files), and try to propagate itself through Internet relay Chat clients
as well as email. If that wasn&#8217;t enough, it would download a file called
<code>WIN-BUGFIX.EXE</code> and execute it. This was not a bug fixing program but
rather a program that extracted user passwords and mailed them to the hacker.</p>

<p>The ILOVEYOU virus transmitted itself largely through email to contacts in infected
computers, so your &#8220;secret admirer&#8221; message came from someone you knew and
hence you were more likely to click on it. An earlier highly successful virus,
Melissa, spread by offering a list of passwords for X-rated web sites. Email-based
virus transmission is still a dominant mechanism. Sender headers and links are
often disguised to make it look like the content is from a legitimate party.</p>

<h3 id="javascriptandpdffiles">JavaScript and PDF files</h3>

<p>JavaScript, like Visual Basic, has evolved into a full programming language.
Most browsers have security holes that involve Javascript. JavaScript can
not only modify the content and structure of a web page but can connect
to other sites. This allows any malicious site to leverage your machine. For
example, systems can perform port scans on a range of IP addresses and report
any detected unsecured services.</p>

<p>PDF (Portable Document Format) files, would seem to be innocent printable
documents, incapable of harboring executable code. However, PDF is a complex
format that can contain a mix of static and dynamic elements. Dynamic elements
may contain Javascript, dynamic action triggers (e.g., &#8220;on open&#8221;), and the
ability to retrieve &#8220;live&#8221; data via embedded URLs. As with Visual Basic
scripts, PDF readers warn users of dynamic content but, depending on the
social engineering around the file, the user may choose to trust the file &#8230; or
not even pay attention to the warning in yet-another-dialog-box.</p>

<h3 id="trojans">Trojans</h3>

<p>A <strong>Trojan horse</strong> is a program with two purposes: an overt purpose and a covert one.
The <strong>overt purpose</strong> is what compels the user to get and run the program in the first place.
The <strong>covert purpose</strong> is unknown to the user and is the malicious part of the program.</p>

<p>For example, a script with the name of a common Linux command might be added to a target user&#8217;s search path.
When the user runs the command, the script is run. That script may, in turn, execute
the proper command, leading the user to believe that all is well. As a side effect,
the script may create a setuid shell to allow the attacker to impersonate that user
or mail copy over some critical data. Users install Trojans because they believe
they are installing useful software, such as an anti-virus tool (BTW, a lot of downloadable
hacker tools contain Trojans: hackers hacking wannabe hackers). The side-effect
of this software can activate cameras, enable key loggers, or deploy bots for anonymization servers,
DDoS attacks, or spam attacks.</p>

<p>Trojans may include programs (games, utilities, anti-malware programs), downloading services, rootkits (see next) and backdoors (see next). They appear to perform a useful task that does not raise suspicion on the part of the victim.</p>

<h3 id="backdoors">Backdoors</h3>

<p>A <strong>backdoor</strong> is software that is designed with some undocumented mechanism to allow
someone who knows about it to be able to access the system or specific functions
in a way that bypasses proper authentication mechanisms. In many
cases, they are not designed for malicious use: they may allow a
manufacturer to troubleshoot a device or a software author to push
an update. However, if adversarial parties discover the presence
of a backdoor, they can use it for malicious purposes.</p>

<p>An old, but famous, example of a backdoor is the <em>sendmail</em>
mail delivery server. The author of <em>sendmail</em> wanted to have development access on
a production system that had the program installed so that he can continue to improve it.
The system administrator refused such access. His next release of <em>sendmail</em> contained
a password-protected backdoor that gave him access to the system via the <em>sendmail</em> server.
The password was hard-coded in the program and soon became well-known. Robert Morris
used the knowledge of this backdoor as one of the mechanisms for his worm to propagate
to other systems. More recently, in 2014, some Samsung Galaxy phones were delivered
with backdoors that provide remote access to the data on the phone. </p>

<h3 id="rootkits">Rootkits</h3>

<p>A <strong>rootkit</strong> is software that is designed to allow an attacker to access
a computer and hide the existence of the software &#8230; and sometimes hide the
presence of the user on the system.</p>

<p>Historically, a basic rootkit would replace common administration commands
(such as <em>ps</em>, <em>ls</em>, <em>find</em>, <em>top</em>, <em>netstat</em>, etc.) with commands that
mimic their operation but hide the presence of intruding users, intruding
processes, and intruding files. The idea is that a system administrator
should be able to examine the system and believe that all is fine and
the system is free of malware (or of unknown user accounts).</p>

<h4 id="usermoderootkits">User mode rootkits</h4>

<p>The rootkit just described is a <strong>user mode</strong> rootkit and involves
replacing commands, intercepting messages, and patching commonly-used APIs
that may divulge the presence of the malware. A skilled administrator
may find unmodified commands or import software to detect the intruding
software. </p>

<h4 id="kernelmoderootkits">Kernel mode rootkits</h4>

<p>A <strong>kernel mode</strong> rootkit is installed as a kernel module. Being in the
kernel gives the rootkit unrestricted access to all system resources and
the ability to patch kernel structures and system calls. For example,
directory listings from the <em>getdents64</em> system call may not report any
names that match the malware. Commands and libraries can be replaced and
not give any indication that malicious software is resident in the system.</p>

<h4 id="hypervisorrootkits">Hypervisor rootkits</h4>

<p>The most insidious rootkits are hypervisor rootkits. A hypervisor sits below
the operating system and is responsible for translating between virtual device
operations from operating systems and the underlying hardware. All I/O flows
through the hypervisor. Most computer systems do not run virtual machines and
hence have no hypervisor. These systems are prime targets for a hypervisor-based
rootkit. Now you can have an environment where the entire operating system
can run unmodified - or even be reinstalled - and be unaware that its operations
are being intercepted at a lower level. The hypervisor does not
have to virtualize all hardware interactions: just the ones
it cares about. For example, it might want to grab keyboard events
to record passwords and messages.</p>

<p>Hypervisor attacks have not been deployed but have been demonstrated as a proof
of concept. The challenge in detecting their presence is that operating systems
are unaware if they are running under a hypervisor, so if a malicious hypervisor
is installed, the operating system needs to detect that it is running
under a hypervisor rather than directly on the computer system.
Detection is difficult and often relies on measuring completion
times of certain system calls. If they go through a hypervisor, they will take a longer
time and the on-chip Time Stamp Counter (TSC), which counts CPU cycles, will
show a longer value with a hypervisor in place. An alternative, and far more obscure,
method of detection, is the use of an instruction that stores the interrupt
descriptor table register (IDTR) into a memory location (the SIDT instruction).
The hypervisor changes the register&#8217;s value and the instruction can detect that.
However, this does not have to take place on a system with only one operating
system, so measuring timing differences may still be the more foolproof approach.</p>

<h3 id="ransomware">Ransomware</h3>

<p>If we think back to the goals of malware, one common goal was to extract money: even
hackers need to monetize their efforts. An indirect way of accomplishing this was
by collecting information to gain access to bank account data, PayPal data, or modifying
accounts that may take money, such as eBay accounts. A more direct way of getting
money is to demand it from the victim. Ransomware is a relatively new form of malware
that locks a computer, keeps it from booting, or encrypts all files on the system.
It then asks the suer to pay a ransom (usually via bitcoin) to get a decryption program.</p>

<h2 id="gatheringinformation">Gathering information</h2>

<p>Malware has varying goals.
These goals may include spying on user activity, destroying content, assembling
a collection of servers, or
extracting money from a victim.
One common goal is to gather information &#8230; or get the user to
provide information. Your computer might not have anything of direct value to an adversary,
but your PayPal, bank, Amazon, or eBay credentials might be useful.</p>

<h3 id="phishing">Phishing</h3>

<p><strong>Phishing</strong> is a social engineering attack whose most common purpose is to get personal information from someone, usually
login credentials to some service. These are often carried out vie email with similar
techniques that are used to spread infected files. A message announcing that your PayPal
account is being canceled, that your bank detected a fraudulent transaction, or that
FedEx could not deliver a package may prompt the receiver to panic and immediately click
on a link in the message, which may result in the browser displaying a site crafted to look
like PayPal, the bank, or FedEx and prompt the user for login and password information.</p>

<p>Phishing attacks are surprisingly effective. A 2018 study by <a href="https://www.proofpoint.com/us/human-factor-2018">Proofpoint</a> found that 52% of all successful phishing emails are clicked on within one hour of being sent.</p>

<p><strong>Spear phishing</strong> is a targeted form of phishing. A phishing attack sends the same message to
a large set of users, hoping that some percentage of them will be fooled. A spear
phishing attack sends a customized message that demonstrates some knowledge of the
target, which will usually lead the target to think that the message is legitimate.
For example, the 2016 Democratic National Committee (DNC) was
facilitated by spear phishing. Targets were sent a message containing <em>bit.ly</em> links, which
is a common URL shortening service that hid the actual underlying URLs. Once clicked, the web site would display what looked like
a legitimate Google accounts login page, already pre-populated with the victim&#8217;s GMail
address. </p>

<p>More recent GMail spear phishing attacks send email to contacts of compromised accounts. The
email contains an innocent-looking attachment: a thumbnail image of a document. When the
victim clicks on the attachment, a web page that looks like a legitimate Google sign-in
page is presented. As soon as the victim enters a name and password, the attackers get the
credentials, log into the account, and target people in the victim&#8217;s contact list. They
use an image of an actual attachment in the victim&#8217;s email and an actual subject line to
make the email look more legitimate.</p>

<p>A <a href="https://www.webroot.com/us/en/about/press-room/releases/nearly-15-million-new-phishing-sites">2017 report</a> by Webroot found that 1.385 million new and unique phishing sites are created each month. Their <a href="https://www.webroot.com/us/en/about/press-room/releases/2019-webroot-threat-report">2019 report</a> pointed out that phishing attacks increased 36 percent over 2018 and the number of phishing sites grew over 220 percent.</p>

<p>Some warning signs that a mail message may be a phishing attack are:</p>

<ol>
<li><p><em>From header</em>: is it from an unknown or suspicious address?</p></li>
<li><p><em>To header</em>: if the message is sent to multiple people, do you recognize any other names on the header?</p></li>
<li><p><em>Date header</em>: if the message purports to be a personal message, was it sent during normal business hours?</p></li>
<li><p><em>Subject header</em>: is the suspicious and is it relevant to your activities?</p></li>
<li><p><em>Message content</em>: is the message a request to click on a link in order to avoid a negative consequence?</p></li>
<li><p><em>Embedded links</em>: are there any links that you are asked to click? If you look at the target of those links, are they misspelled, suspicious, or for a site different from that of the sender?</p></li>
<li><p><em>Attachments</em>: is there an unexpected attachment that you are expected to open, such as a Microsoft Word document or PDF file?</p></li>
</ol>

<h4 id="embeddedurls">Embedded URLs</h4>

<p>Astute users who are aware of phishing attacks have become accustomed to examining the targets of a link rather than just blindly clicking on a link (unfortunately, this may not be possible on mobile devices in many cases). If the link looks suspicious, the likelihood of it being clicked diminished. In addition to setting up misspelled and authentic-sounding domain names, attackers found it convenient to simply use URL shortening services, such as bit.ly. For example, a link to <a href="http://www.poopybrain.com">poopybrain.com</a> may appear suspicious but a link to <a href="https://bit.ly/30zQv0u">https://bit.ly/30zQv0u</a> disguises the target and users are accustomed to receiving shortened URLs for legitimate content.</p>

<p>Mail servers, such as Microsoft&#8217;s Office 365 service, build up lists of known malicious links and attackers need to get through those systems. They <a href="https://www.zdnet.com/article/spammers-use-hexadecimal-ip-addresses-to-evade-detection">recently realized</a> that they could get around filtering services by using IP addresses instead of domain names in URLs. On top of that, the IP address need not be presented in the standard dotted-decimal notation but may be in octal or hexadecimal as well as non-dotted formats. All of the following addresses are equivalent:</p>

<p>| :&#8212;- |
| http://www.poopybrain.com |
| http://73.215.234.231 |
| http://0111.0327.0352.0347 |
| http://0x49.0xd7.0xea.0xe7 |
| http://0x49D7EAE7 |
| http://011165765347 |
| http://1238887143 |</p>

<h3 id="voicephishing">Voice phishing</h3>

<p>The huge shift to work-at-home environments in 2020 led to attackers trying to get access credentials to corporate networks from employees working from home. One technique that was created was <a href="https://krebsonsecurity.com/2020/08/voice-phishers-targeting-corporate-vpns/">voice phishing</a>.</p>

<p>A voice phishing attack involves an attacker contacting employees at home and using pretexting to convince them that they are calling from the company&#8217;s IT department to troubleshoot connectivity problems on the corporate VPN. The attacker may create plausible-looking LinkedIn profiles to help in this deception.</p>

<p>In its simplest form, the attacker may simply obtain access credentials via the voice call. To improve the odds of success, attackers have created phishing pages that look like they belong to many of the world&#8217;s biggest companies. These pages request login credentials, including one-time passwords or any special access codes required by the company. When an victim enters data in that page, the attacker can immediately log into the corporate network.</p>

<h3 id="calendarinjection">Calendar injection</h3>

<p>A social engineering attack that has gained popularity in 2020 and the expanded use of video conferencing is <strong>calendar injection</strong>.</p>

<p>An attacker inserts a calendar event into the victim&#8217;s calendar. The event is a plausible-sounding video conference (think of topics such as <em>staff meeting</em>, <em>all-hands meeting</em>, <em>company update</em>, <em>performance review</em>, or <em>corporate restructuring and workforce adjustment</em>). When the victim clicks on the link, the browser may present a dialog box asking the user for permission to &#8220;open&#8221; the program needed to run the conference &#8230; or to download the conference program. These are expected events in normal conferences. In reality, of course, the link or the downloaded program will be malicious.</p>

<p>Attackers can install these injections via various forms of malware or via a malicious website that would download a calendar invitation. More commonly, the calendar event can be sent in a spoofed mail message and the mail client software may automatically parse the message, see the invitation, and add it to the calendar.</p>

<h3 id="deceptivewebsites">Deceptive web sites</h3>

<p>Quite often, malicious links in phishing attacks direct the user to a web site in order to obtain their login credentials. These sites <a href="https://www.cyberscoop.com/awpg-phishing-2016-report-tlds-malicious-registrations-cybercrime/">masquerade as legitimate sites</a>. The
<a href="https://www.itgovernanceusa.com/blog/52-of-phishing-victims-click-within-one-hour">Proofpoint study</a> mentioned earlier found that for every legitimate website, there are 20 malicious sites that mimic it. This is known as <strong>typosquatting</strong>. Such sites can be masqueraded banking sites, Google/Microsoft/Apple authentication pages, videoconferencing plugin-software downloads, etc.</p>

<p>File serving sites, including those that host software or those that provide services such as PDF or mp3 conversion are often ad-sponsored. Some of the ads on these sites, however, often look like download links and can trick a user into clicking on the ad instead of the link for the actual content. The </p>

<h3 id="keyloggers">Keyloggers</h3>

<p>Another way of obtaining information is to snoop on a user&#8217;s actions.
<strong>Keyloggers</strong> record everything a victim types and allow a user to extract
login names, passwords, and entire messages.</p>

<p>Keyloggers can be implemented in several ways:</p>
<dl>
<dt>Malicious hypervisor</dt>
<dd>Since a hypervisor provides virtual interfaces for all the resources of a computer,
it can capture all keyboard, mouse, and even video data. These attacks are difficult since
they rely on the ability to install a hypervisor.</dd>

<dt>Kernel-based rootkit</dt>
<dd>All input/output operations go through the operating system kernel. Modifying the
kernel allows malicious software to log and upload keystroke data.</dd>

<dt>System call hooking</dt>
<dd>Some operating systems provide a system call hooking mechanism that allows
data to and from system calls to be intercepted. We saw how this was used to
implement sandboxing. Windows enables this without
having to install any kernel-level drivers. The <code>SetWindowsHookEx</code> system
call can be used to report WH_KEYBOARD and WH_MOUSE events, capturing keyboard
and mouse activity.</dd>

<dt>Browser-based logging</dt>
<dd>JavaScript can be used to capture <code>onKeyUp()</code> events. These
events will be captured for one page but other hacks can be used to create a broader
context with embedded pages. Form submission can also be intercepted to get
populated form data without having to reassemble key presses into coherent
account credentials.</dd>

<dt>Hardware loggers</dt>
<dd>Although visible to the user, hardware key loggers can be used for USB-connected
keyboards. Some of these have embedded Wi-Fi transceivers that enable an attacker
to collect the data from a distance.</dd>
</dl>


<h2 id="defenses">Defenses</h2>

<p>Malware was particularly easy to spread on older Windows systems since user accounts, and hence processes, ran with full administrative rights, which made it easy to modify any
files on the system and even install kernel drivers. Adding <strong>file protection</strong>
mechanisms, such as a distinction between user and administrator accounts added
a significant layer of protection. However, malware installed by the user would
run with that user&#8217;s privileges and would have full access to all of a user&#8217;s files.
If any files are read or write protected, the malware can change DAC permissions.</p>

<p>Systems took the approach of warning users if software wanted to install software
or asked for elevated privileges. Social engineering hopes to convince users
that they actually <em>want</em> to install the software (or view the
document). They will happily grant permissions and install the malware. MAC permissions
can stop some viruses as they will not be able, for instance, to override write permissions on
executable files but macro viruses and the user files are still a problem.</p>

<p>In general, however, studies have shown that by simply taking away admin rights (avoiding privilege escalation)
from users, 94% of the 530 Microsoft vulnerabilities that were reported in 2016
could be mitigated and 100% of vulnerabilities in Office 2016 could be mitigated.</p>

<h3 id="anti-virusanti-malwaresoftware">Anti-virus (anti-malware) software</h3>

<p>There is no way to recognize all possible viruses. <strong>Anti-virus</strong> software uses two strategies: <em>signature-based</em> and <em>behavior-based</em> approaches.</p>

<p>With <strong>signature-based</strong> systems, anti-virus programs look for byte sequences that match those in known malware. Each bit pattern is an excerpt of code from a known virus and is called
a <strong>signature</strong> (not to be confused with <em>digital signatures</em>, discussed later in the course). A virus signature is simply a set of bytes that make up a portion of the virus and allow scanning software to see whether that virus is embedded in a file. The hope is that the signature is long
enough and unique enough that the byte pattern will not occur in legitimate programs.
This scanning process is called <strong>signature scanning</strong>. Lists of signatures (&#8220;<strong>virus definitions</strong>&#8221;) have to be updated by the anti-virus software vendor as new viruses are discovered. Signature-based detection is used by most anti-virus products.</p>

<p>With <strong>Heuristic analysis</strong>, the system monitors the activities of a process (typically the system calls or standard library calls that it makes). This is a <strong>behavior-based</strong> technique. </p>

<p>With <strong>static heuristic analysis</strong>, the potentially malicious code is not run but is decompiled to source code. The source code is compared with source code in a database of known malicious code. The analyzer looks for suspicious operations, such as attempts to access specific files, certain system calls, use of packers, attempts to create self-modifying code. Each of these can increase the &#8220;score&#8221; of the item being scanned. If the score is high enough, it can be market as suspicious.</p>

<p>With <strong>dynamic heuristic analysis</strong>, the code is executed. Some form of isolation is required. <strong>Sandboxing</strong> is usually employed, to ensure that the suspected code is run within a sandbox or even in an interpreted environment within a sandbox to ensure that it cannot cause real damage. Behavior-based systems try to perform <strong>anomaly detection</strong>. If the observed activity is deemed suspicious, the process is terminated and the user alerted. Sandboxed, behavior-based analysis is often run by anti-malware companies to examine what a piece of suspected malware is actually doing and whether it should be considered to be a virus. A behavior-based can identify previously-unseen malware but these systems tend to have higher false positive rates of detection: it is difficult to characterize exactly what set of operations constitute suspicious behavior.</p>

<p>Windows Defender, as an example, makes use of both signature-based scanning, static heuristic analysis, as well as dynamic process monitoring. It uses signature-based scanning on files and behavior-based analysis for running processes. Behavior monitoring includes scanning for suspicious file and registry changes (e.g., ransomware may try to encrypt all the files on a system and a lot of malware may try to modify the registry so that the software runs when the system is rebooted. </p>

<h3 id="countermeasures">Countermeasures</h3>

<p>Some viruses will take measures to try to defend themselves from anti-virus software.</p>

<h4 id="signaturescanningcountermeasures">Signature scanning countermeasures</h4>

<p>A common thing to do in malware is to use a <strong>packer</strong> on the code, unpacking it prior to execution. Packing can be one of several operations:</p>

<ul>
<li>Simply obscure the malware payload by exclusive-oring (xor) with a repeating byte pattern (exclusive-oring the data with the same byte pattern reconstructs it.</li>
<li>Compress the code and then uncompress it upon loading it prior to execution.</li>
<li>Encrypt the code and decrypt it prior to execution.</li>
</ul>

<p>All of these techniques will change the signature of a virus. One can scan for a signature of a compressed version of the virus but there are dozens of compression algorithms around, so the scanning process gets more complicated.</p>

<p>With encryption (xor is a simple form of encryption), only the non-encrypted part of the virus contains the unpacking software (decryption software and the key). A virus
scanner will need to match the code for the unpacker component since the key and
the encrypted components can change each time the virus propagates itself.</p>

<p><strong>Polymorphic viruses</strong>
mutate their code each time they run while keeping the algorithm the same. This
involves replacing sequences of instructions with functionally-identical ones. For
example, one can change additions to subtractions of negative numbers, invert
conditional tests and branches, and insert or remove no-op instructions. This thwarts signature scanning software because the the byte pattern of the virus is different each time.</p>

<h4 id="accesscontrolcountermeasures">Access control countermeasures</h4>

<p>Access controls help but do not stop the problem of malware.
Containment mechanisms such as containers work well for server software but
are usually impractical for user software (e.g., you want Microsoft Word to be
able to read documents anywhere in a user&#8217;s directories). Application sandboxing is generally far more effective and is a dominant technique used in mobile software.</p>

<p>Trojans, deceptive downloads, and phishing attacks are insidiously difficult to defend against since
we are dealing with human nature: users <em>want</em> to install the software or
provide the data. They are conditioned to accepting pop-up messages and entering a password.
Better detection in browsers &amp; mail clients against suspicious content or URLs helps. However, malware distributors have been known to simply ask a user to rename a file to turn it into one that is recognized by the operating system as an executable file (or a disk image, PDF, or whatever format the malware come in and may otherwise be filtered by the mail server or web browser.</p>

<h4 id="sandboxingcountermeasures">Sandboxing countermeasures</h4>

<p>Viruses are unlikely to get through a sandbox (unless there are vulnerabilities or an improper configuration). However, there are areas where malware can address sandboxing:</p>

<ol>
<li><p>Vendor examination<br/>
Anti-virus vendors often test software within a tightly configured sandboxed environment so they can detect whether the software is doing anything malicious (e.g., accessing files, devices, or the network in ways it is not supposed to). If they detect that they do have malware, they will dig in further and extract a signature so they can update and distribute their list of virus definitions.
Viruses can try to get through this examination phase by setting a trigger to keep the virus from immediately performing malicious actions or to stay dormant for the first several invocations. The hope is that the anti-virus vendors will not see anything suspicious and the virus will never be flagged as such by their software.</p></li>
<li><p>User configuration (entitlements)<br/>
Virtually all mobile applications, and increasingly more desktop/laptop applications, are run with application sandboxes in place. These may disallow malware from accessing files, devices, or the network. However, it never hurts to ask. The software can simply ask the user to modify the sandbox settings. If social engineering is successful, the user may not even be suspicious and not wonder why a game wants access to contacts or location information.</p></li>
</ol>

<h1 id="references">References</h1>

<p>Fedor Sinitsyn, <a href="https://securelist.com/blog/research/74609/petya-the-two-in-one-trojan/">Petya: the two-in-one trojan</a>, SecureList, May 4, 2016
hasherezade, <a href="https://blog.malwarebytes.com/threat-analysis/2016/04/petya-ransomware/">Petya – Taking Ransomware To The Low Level</a>, Malwarebytes Labs, April 1, 2016</p>

<p><a href="https://www.howtogeek.com/203061/don’t-panic-but-all-usb-devices-have-a-massive-security-problem/">Don’t Panic, But All USB Devices Have a Massive Security Problem</a>, How-To Geek, 2014.</p>

<p>Lavasoft, <a href="http://www.lavasoft.com/mylavasoft/securitycenter/whitepapers/lnk-exploits">LNK Exploits</a>, 2010</p>

<p>IEEE Spectrum, <a href="http://spectrum.ieee.org/telecom/security/the-real-story-of-stuxnet">The Real Story of Stuxnet</a>, February 2013.</p>

<p>Trend Micro SimplySecurity, <a href="http://blog.trendmicro.com/macro-malware-heres-what-you-need-to-know-in-2016/">Macro Malware: Here’s what you need to know in 2016</a>, March 2016</p>

<p>SANS, <a href="https://www.sans.org/security-resources/malwarefaq/pdf-overview">PDF Malware Overview</a>, July 2010.</p>

<p>George Ou, <a href="http://www.zdnet.com/article/blue-pill-the-first-effective-hypervisor-rootkit/">Blue Pill: The first effective Hypervisor Rootkit</a>, ZDNet, August 15, 2006</p>

<div class="footnotes">
<hr />
<ol>

<li id="fn:1">
<p>Matthew Tischer, Zakir Durumeric, et al., <a href="https://zakird.com/papers/usb.pdf">Users Really Do Plug in USB Drives They Find</a>, University of Illinois,  <a href="#fnref:1" title="return to article" class="reversefootnote">&#160;&#8617;</a></p>
</li>

</ol>
</div>


							</section>
							<footer class="main">
								Last modified November 25, 2020.
								<hr/>
								<p class="copyright">&copy; Paul Krzyzanowski. All rights reserved.
								</p>

								<p class="copyright">
								For questions or comments about this site, contact Paul Krzyzanowski, 
								<span class="codedirection">gro.kp@ofnibew</span>
								</p>

		<img src="../../assets/images/recycled_pixels_logo.png" alt="recycled pixels" height="80" width="80" class="noprint" />

								<p class="copyright">
		The entire contents of this site are protected by copyright under national and international law. No part of this site may be copied, reproduced, stored in a retrieval system, or transmitted, in any form, or by any means whether electronic, mechanical or otherwise without the prior written consent of the copyright holder. If there is something on this page that you want to use, please let me know.
		
		Any opinions expressed on this page do not necessarily reflect the opinions of my employers and may not even reflect my own.
								</p>
								<p class="copyright noprint">
								Page design derived from: <a href="https://html5up.net">HTML5 UP</a>.</p>
							</footer>

						</div>
					</div>

		<!-- Sidebar -->
			<div id="sidebar" class="noprint">
				<div class="inner">

					<!-- Menu -->
<nav id="menu">
	<header class="major">
		<h2>Menu</h2>
	</header>
	<ul>
		<li><a href="../../index.html">Homepage</a></li>
		<li><a href="../index.html">Main course page</a></li>
		<li><a href="../syllabus.html">Syllabus</a></li>
		<li><a href="../news.html">Announcements</a></li>
		<li><a href="../hw/index.html">Homework</a></li>
		<li><a href="../notes/index.html">Documents</a></li>
		<li><a href="../grades.html">Grading info</a></li>
		<li><a href="https://canvas.rutgers.edu">Canvas</a></li>
		<li>
			<span class="opener">Course info</span>
			<ul>
				<li><a href="../about.html">About the course</a></li>
				<li><a href="../prereq.html">Prerequisistes</a></li>
				<li><a href="../things.html">Things you need</a></li>
				<li><a href="../policy.html">Class rules</a></li>
			</ul>
		</li>
	</ul>
</nav>

					<!-- Section -->
						<section>
							<header class="major">
								<h2>Get in touch</h2>
							</header>
							<p> For questions or comments about this site, contact Paul Krzyzanowski: </p>
							<ul class="contact">
								<li class="icon solid fa-envelope"><a href="#">
									<style type="text/css"> span.codedirection { unicode-bidi:bidi-override; direction: rtl; } </style>
									<a href="mailto:webinfo@pk@@org" onmouseover="this.href=this.href.replace('@@','.')">
										<span class="codedirection">gro.kp@ofnibew</span>
									</a>
								</li>
							</ul>
						</section>

					<!-- Footer -->
					<footer id="footer">
						<p class="copyright">&copy; Paul Krzyzanowski. All rights reserved.
						</p>


					</footer>

				</div>
			</div>
	</div>

<!-- Scripts -->
	<script src="../../assets/js/jquery.min.js"></script>
	<script src="../../assets/js/browser.min.js"></script>
	<script src="../../assets/js/breakpoints.min.js"></script>
	<script src="../../assets/js/util.js"></script>
	<script src="../../assets/js/main.js"></script>
	</body>
</html>
